#tag WindowBegin Window wndArtPreview   BackColor       =   16777215   Backdrop        =   ""   CloseButton     =   False   Composite       =   False   Frame           =   8   FullScreen      =   False   HasBackColor    =   False   Height          =   400   ImplicitInstance=   True   LiveResize      =   False   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   32000   MenuBar         =   ""   MenuBarVisible  =   True   MinHeight       =   64   MinimizeButton  =   False   MinWidth        =   64   Placement       =   0   Resizeable      =   False   Title           =   "Download Art"   Visible         =   True   Width           =   600   Begin Canvas cvsArtViewer      AcceptFocus     =   ""      AcceptTabs      =   ""      AutoDeactivate  =   True      Backdrop        =   ""      DoubleBuffer    =   True      Enabled         =   True      EraseBackground =   True      Height          =   348      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   0      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      Scope           =   0      TabIndex        =   0      TabPanelIndex   =   0      TabStop         =   True      Top             =   0      UseFocusRing    =   True      Visible         =   True      Width           =   600   End   Begin ccCancelSave CancelSave      AcceptFocus     =   ""      AcceptTabs      =   True      AutoDeactivate  =   True      BackColor       =   16777215      Backdrop        =   ""      Enabled         =   True      EraseBackground =   True      HasBackColor    =   False      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   408      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   False      mOKCaption      =   "&Save"      Scope           =   0      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      Top             =   360      UseFocusRing    =   ""      Visible         =   True      Width           =   172   End   Begin Label lblCounter      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   False      LockTop         =   False      Multiline       =   ""      Scope           =   0      Selectable      =   False      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      Text            =   "## / ##"      TextAlign       =   2      TextColor       =   0      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   360      Transparent     =   False      Underline       =   ""      Visible         =   True      Width           =   60   End   Begin UpDownArrows udArtIndex      AcceptFocus     =   False      AutoDeactivate  =   True      Enabled         =   True      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   92      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      Scope           =   0      TabIndex        =   3      TabPanelIndex   =   0      TabStop         =   True      Top             =   360      Visible         =   True      Width           =   13   End   Begin Label lblSize      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   117      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   False      Multiline       =   ""      Scope           =   0      Selectable      =   False      TabIndex        =   4      TabPanelIndex   =   0      TabStop         =   True      Text            =   "1920x1080"      TextAlign       =   1      TextColor       =   0      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   360      Transparent     =   False      Underline       =   ""      Visible         =   True      Width           =   279      Begin ProgressWheel pgWheel         AutoDeactivate  =   True         Enabled         =   True         Height          =   22         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "lblSize"         Left            =   374         LockBottom      =   True         LockedInPosition=   False         LockLeft        =   False         LockRight       =   True         LockTop         =   False         Scope           =   0         TabIndex        =   0         TabPanelIndex   =   0         TabStop         =   True         Top             =   360         Visible         =   False         Width           =   22      End   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Function KeyDown(Key As String) As Boolean		  if Keyboard.AsyncKeyDown(&h7E) or Keyboard.AsyncKeyDown(&h7C) then		    ArtValue = ArtValue + 1		  ElseIf Keyboard.AsyncKeyDown(&h7B) or Keyboard.AsyncKeyDown(&h7D) then		    ArtValue = ArtValue - 1		  end if		  		  UpdateAll		End Function	#tag EndEvent	#tag Event		Sub Open()		  'self.FullScreenAuxiliaryMBS = true		  		  ArtValue = 0		  ArtMax = Scrape.ArtThumb.Ubound		  		  if ArtMax < 1 then		    lblCounter.Visible = False		    udArtIndex.Visible = False		  end if		  		  UpdateAll		End Sub	#tag EndEvent	#tag Method, Flags = &h1		Protected Sub SaveImage()		  Dim ImageLocation, ImageDestination As FolderItem		  Dim Message, Explanation As String		  		  Explanation = "If you choose 'ok', the existing image will be replaced with the new image, this cannot be undone."		  Message = " image already exists, replace image?"		  		  ImageLocation = SpecialFolder.Temporary		  if wndMain.ppMedia.Value = 0 then		    ImageDestination = MovieAttr.FolderParent		  elseif wndMain.ppMedia.Value = 1 then		    ImageDestination = TVAttr.FolderParent		  elseif wndMain.ppMedia.Value = 2 then		    ImageDestination = AnimeAttr.FolderParent		  end if		  		  pgWheel.Visible = True		  CancelSave.Enabled = False		  		  // Image mode		  Select case Mode		    		    // TVDB ---------------------------		  case "TVDB-Poster"		    ImageLocation = ImageLocation.Child("Thumb_" + str(ArtValue) + ".jpg")		    if wndMain.ppMedia.Value = 1 then		      ImageDestination = TVAttr.ShowPosterFilter		      if ImageDestination = nil then ImageDestination = TVAttr.FolderParent.Child("Poster.jpg")		    elseif wndMain.ppMedia.Value = 2 then		      ImageDestination = AnimeAttr.ShowPosterFilter		      if ImageDestination = nil then ImageDestination = AnimeAttr.FolderParent.Child("Poster.jpg")		    end if		    		    Message = "Poster" + Message		    		  case "TVDB-Fanart"		    ImageLocation = ImageLocation.Child("Thumb_" + str(ArtValue) + ".jpg")		    if wndMain.ppMedia.Value = 1 then		      ImageDestination = TVAttr.ShowFanartFilter		      if ImageDestination = nil then ImageDestination = TVAttr.FolderParent.Child("Fanart.jpg")		    elseif wndMain.ppMedia.Value = 2 then		      ImageDestination = AnimeAttr.ShowFanartFilter		      if ImageDestination = nil then ImageDestination = AnimeAttr.FolderParent.Child("Fanart.jpg")		    end if		    Message = "Fanart" + Message		    		  case "TVDB-Series"		    ImageLocation = ImageLocation.Child("Thumb_" + str(ArtValue) + ".jpg")		    if wndMain.ppMedia.Value = 1 then		      ImageDestination = TVAttr.ShowBannerFilter		      if ImageDestination = nil then ImageDestination = TVAttr.FolderParent.Child("Banner.jpg")		    elseif wndMain.ppMedia.Value = 2 then		      ImageDestination = AnimeAttr.ShowBannerFilter		      if ImageDestination = nil then ImageDestination = AnimeAttr.FolderParent.Child("Banner.jpg")		    end if		    Message = "Banner" + Message		    		    // FanartTV -----------------------		  case "FanartTV-clearart"		    ImageLocation = ImageLocation.Child("Thumb_" + str(ArtValue) + ".png")		    if wndMain.ppMedia.Value = 1 then		      ImageDestination = TVAttr.FolderParent.Child("ClearArt.png")		    elseif wndMain.ppMedia.Value = 2 then		      ImageDestination = AnimeAttr.FolderParent.Child("ClearArt.png")		    end if		    Message = "ClearArt" + Message		    		  case "FanartTV-clearlogo"		    ImageLocation = ImageLocation.Child("Thumb_" + str(ArtValue) + ".png")		    if wndMain.ppMedia.Value = 1 then		      ImageDestination = TVAttr.FolderParent.Child("Logo.png")		    elseif wndMain.ppMedia.Value = 2 then		      ImageDestination = AnimeAttr.FolderParent.Child("Logo.png")		    end if		    Message = "Logo" + Message		    		  case "FanartTV-tvthumb"		    ImageLocation = ImageLocation.Child("Thumb_" + str(ArtValue) + ".jpg")		    if wndMain.ppMedia.Value = 1 then		      ImageDestination = TVAttr.FolderParent.Child("Landscape.png")		    elseif wndMain.ppMedia.Value = 2 then		      ImageDestination = AnimeAttr.FolderParent.Child("Landscape.png")		    end if		    Message = "TV Thumb" + Message		    		    // TMDB ---------------------------		  case "TMDB-Poster"		    MovieAttr.ART_Poster = URL2Picture( Scrape.ArtURL(ArtValue), "poster" )		    ImageLocation = ImageLocation.Child("poster.jpg")		    if wndMain.ppMedia.Value = 0 then		      ImageDestination = MovieAttr.MoviePosterFilter( MovieAttr.FolderParent )		      if ImageDestination = nil then ImageDestination = MovieAttr.FolderParent.Child("Poster.jpg")		    elseif wndMain.ppMedia.Value = 2 then		      ImageDestination = MovieAttr.MoviePosterFilter( AnimeAttr.FolderParent )		      if ImageDestination = nil then ImageDestination = AnimeAttr.FolderParent.Child("Poster.jpg")		    end if		    Message = "Poster" + Message		    		  case "TMDB-Fanart"		    MovieAttr.ART_Fanart = URL2Picture( Scrape.ArtURL(ArtValue), "fanart" )		    ImageLocation = ImageLocation.Child("fanart.jpg")		    if wndMain.ppMedia.Value = 0 then		      ImageDestination = MovieAttr.MovieFanartFilter( MovieAttr.FolderParent )		      if ImageDestination = nil then ImageDestination = MovieAttr.FolderParent.Child("Fanart.jpg")		    elseif wndMain.ppMedia.Value = 2 then		      ImageDestination = MovieAttr.MovieFanartFilter( AnimeAttr.FolderParent )		      if ImageDestination = nil then ImageDestination = AnimeAttr.FolderParent.Child("Fanart.jpg")		    end if		    Message = "Fanart" + Message		    		  end select		  		  // Move image		  if ImageDestination <> nil and ImageDestination.Exists and ImageLocation.Exists then		    		    if dlgWindow( Message, Explanation ) then		      ImageDestination.Delete		      ImageLocation.CopyFileTo( ImageDestination )		    end if		    		  elseif ImageDestination <> nil and NOT ImageDestination.Exists and ImageLocation.Exists then		    ImageLocation.CopyFileTo( ImageDestination )		    		  elseif not ImageLocation.Exists then		    MsgBox "Temporary image not found" + chr(13) + chr(13) + "Couldn't move temporary image to it's destination, try again later"		  end if		  		  pgWheel.Visible = False		  CancelSave.Enabled = True		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub UpdateAll()		  		  if ArtValue > ArtMax then		    ArtValue = 0		  elseif ArtValue < 0 then		    ArtValue = ArtMax		  end if		  if Scrape.ArtSize.Ubound > -1 then lblSize.Text = Scrape.ArtSize(ArtValue) else lblSize.Text = ""		  		  lblCounter.Text = str(ArtValue + 1) + "/" + str(ArtMax + 1)		  cvsArtViewer.Refresh(False)		End Sub	#tag EndMethod	#tag Property, Flags = &h1		Protected ArtMax As Integer = 0	#tag EndProperty	#tag Property, Flags = &h1		Protected ArtValue As Integer = 0	#tag EndProperty	#tag Property, Flags = &h0		Mode As String	#tag EndProperty#tag EndWindowCode#tag Events cvsArtViewer	#tag Event		Sub Paint(g As Graphics)		  Dim DrawThis As Picture		  		  g.ForeColor = &c929292		  g.FillRect 0, 0, me.Width, me.Height		  		  if ArtValue = -1 or Scrape.ArtThumb(ArtValue) = nil then Return		  		  if Mode <> "FanartTV-clearlogo" and mode <> "FanartTV-clearart" then		    DrawThis = ScalePic( Scrape.ArtThumb(ArtValue), me.Width, me.Height )		    g.DrawPicture( DrawThis, (me.Width / 2) - (DrawThis.Width / 2), me.Height - DrawThis.Height )		  else		    DrawThis = ArtThumb(ArtValue)		    g.DrawPicture( DrawThis, (me.Width / 2) - (DrawThis.Width / 2), (me.Height / 2) - (DrawThis.Height / 2) )		  end if		  		End Sub	#tag EndEvent#tag EndEvents#tag Events CancelSave	#tag Event		Sub ActionCancel()		  self.Close		  CleanTemporaryFiles		End Sub	#tag EndEvent	#tag Event		Sub ActionOK()		  SaveImage		  		  CleanTemporaryFiles		  		  if wndMain.ppMedia.value = 0 then		    'Scrape.SaveNFOFile( MovieAttr.FolderParent, "Movie" )		    wndMain.PopulateMoviesList		  elseif wndMain.ppMedia.Value = 1 then		    'Scrape.SaveNFOFile( TVAttr.FolderParent, "TVShow")		    wndMain.PopulateTVShowsList		  ElseIf wndMain.ppMedia.Value = 2 then		    wndMain.PopulateAnimeList		  end if		  		  self.Close		End Sub	#tag EndEvent#tag EndEvents#tag Events udArtIndex	#tag Event		Sub Up()		  ArtValue = ArtValue + 1		  UpdateAll		End Sub	#tag EndEvent	#tag Event		Sub Down()		  ArtValue = ArtValue - 1		  UpdateAll		End Sub	#tag EndEvent#tag EndEvents