#tag ModuleProtected Module CommonCore	#tag Method, Flags = &h0		Function ActiveListbox() As Listbox		  Select Case wndMain.ppMain.Value		    		  Case 0		    Return wndMain.lstMovies		  Case 1		    Return wndMain.lstTVShows		  Case 2		    #pragma Warning "Build the Anime section first"		    		  End Select		End Function	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub Clean()		  wndClean.Show		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Function CurrentMovieName() As String		  Return FindMovieName( MovieAttr.FolderParent, True, NOT Prefs.boolForKey("UseFolderNameForLookUp") )		End Function	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub DeleteItem()		  If ActiveListbox.ListIndex = -1 Then		    MsgBox Loc.kNothingToDelete		    Return		  End If		  		  		  Dim Path as String = ActiveListbox.Cell( ActiveListbox.ListIndex, 1 )		  		  If ActiveListbox = wndMain.lstMovies Then wndMain.lstMovies.DeleteItem		  		  wndMain.ActBar( wndMain.ppMain.Value ).TextValue( Str( ActiveListbox.ListCount ) + " " + SectionName )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub EditInfo()		  If ActiveListbox = wndMain.lstMovies Then wndMovieMetadata.Show		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub FetchMetadata()		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kSearching + ":", CurrentMovieName, 0, "SelectedMovie" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub FetchMissingMetadata()		  Dim UnScrapedItems as Integer = 0		  For i as Integer = 0 to ActiveListbox.ListCount - 1		    If ActiveListbox.Cell(i, 2) = "" Then UnScrapedItems = UnScrapedItems + 1		  Next		  		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kSearching + ":", Loc.Movies + "...", UnScrapedItems, "MissingMovies" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub GetImageBackdrop()		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kDownloading + ":", Loc.kFanart, 2, "GetMovieFanart" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub GetImageBanner()		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kSearching + ":", Loc.kBanner + "...", 0, "GetMovieBanner" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub GetImageCharacterArt()		  		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub GetImageClearArt()		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kSearching + ":", Loc.kClearArt + "...", 0, "GetMovieArt" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub GetImageDiscArt()		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kSearching + ":", Loc.kDiscArt + "...", 0, "GetMovieDisc" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub GetImageLogo()		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kSearching + ":", Loc.kLogo + "...", 0, "GetMovieLogo" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub GetImagePoster()		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kDownloading + ":", Loc.kPoster, 2, "GetMoviePoster" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub GetImagesExtraBackdrops()		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kDownloading + ":", Loc.kExtraFanarts, 0, "GetMovieExtraFanart" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub GetImagesExtraThumbs()		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kDownloading + ":", Loc.kExtraThumbs, 0, "GetMovieExtraThumbs" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub GetImageThumb()		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kSearching + ":", Loc.kThumb + "...", 0, "GetMovieThumb" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub GetMovieTrailer()		  Dim ID as String = MovieAttr.ID_IMDB		  If ID = "" Then ID = MovieAttr.ID_TMDB		  		  If ActiveListbox = wndMain.lstMovies And ID <> "" Then		    dlgProgress.Start( Loc.kDownloading + ":", Loc.kTrailer + "...", 0, "GetTrailer" )		  Else		    MsgBox Loc.msgNoTrailer		  End If		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub ManualSearch()		  If ActiveListbox = wndMain.lstMovies Then		    wndSearchMovies.Show		    wndSearchMovies.ccSearchMovies.edtSearch.Text = CurrentMovieName		    wndSearchMovies.ccSearchMovies.edtSearch.SelectAll		  End If		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub MarkAsWatched()		  If ActiveListbox = wndMain.lstMovies Then		    MovieAttr.StatusWatched = NOT MovieAttr.StatusWatched		    If MovieAttr.FolderParent <> Nil And MovieAttr.FolderParent.Exists Then MovieAttr.NFOWrite( MovieAttr.DestinationNFO( MovieAttr.FolderParent ) )		    wndMain.lstMovies.UpdateRow		    wndMain.lstMovies.SortList		  End If		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub ReloadList()		  		  If ActiveListbox = wndMain.lstMovies Then		    If wndMain.ccSearchBoxMovies.edtSearch.Text <> "" Then wndMain.ccSearchBoxMovies.Reset		    dlgProgress.Start( Loc.Refresh, "", 0, "ReloadMovies" )		    		  ElseIf ActiveListbox = wndMain.lstTVShows Then		    #pragma Warning "Build the TV Section first"		    		  End If		  		  wndMain.ActBar( wndMain.ppMain.Value ).TextValue( Str( ActiveListbox.ListCount ) + " " + SectionName )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub RenameAll()		  Dim FoldersOrFiles as String = Loc.kFolders.Lowercase		  If Prefs.integerForKey("BatchRename") = 1 Then FoldersOrFiles = Loc.kFoldersandFiles.Lowercase		  // Check to see weather the user will go trough with this.		  If MsgDlg( wndMain, 1, Loc.msgMassRename.ReplaceAll( "%F", FoldersOrFiles ), Loc.kCantBeUndone, Loc.dlgRename, Loc.dlgCancel ) = 2 Then Return		  		  		  Dim ScrapedItems as Integer = 0		  For i as Integer = 0 to ActiveListbox.ListCount - 1		    If ActiveListbox.Cell(i, 2) <> "" Then ScrapedItems = ScrapedItems + 1		  Next		  		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Menu.ToolsBatchRenaming + ":", SectionName, ScrapedItems, "BatchRenameMovies" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub RenameSelection()		  If ActiveListbox = wndMain.lstMovies Then SingleRenamer( MovieAttr.FolderParent )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub ShareOn(Service as String = "Facebook")		  Dim URL, Message as String		  		  If ActiveListbox = wndMain.lstMovies Then		    		    If MovieAttr.ID_TMDB <> "" Then		      URL = "http://www.themoviedb.org/movie/" + MovieAttr.ID_TMDB		    ElseIf MovieAttr.ID_IMDB <> "" Then		      URL = "http://imdb.com/title/" + MovieAttr.ID_IMDB		    End If		    		    If MovieAttr.Title <> "" Then		      If MovieAttr.DateYear > -1 Then Message = MovieAttr.Title + " (" + Str( MovieAttr.DateYear ) + ")" Else Message = MovieAttr.Title		    End If		    		  End If		  		  		  If Message <> "" And URL <> "" Then		    If Service = "Facebook" Then ShareFaceBookLink URL, Message		    If Service = "Twitter"  Then ShareTweet Message + " " + URL + " #ViMediaManager"		  End If		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub ShowInFinder()		  If ActiveListbox = wndMain.lstMovies Then ShowInFinder( MovieAttr.FolderParent )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub ShowListingGoogle()		  If ActiveListbox = wndMain.lstMovies Then		    		    If MovieAttr.Title <> "" And MovieAttr.DateYear > -1 Then		      ShowURL "http://www.google.com/search?q=" + MovieAttr.Title + " (" + Str( MovieAttr.DateYear ) + ")"		    ElseIf MovieAttr.Title <> "" Then		      ShowURL "http://www.google.com/search?q=" + MovieAttr.Title		    End If		    		  End If		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub ShowListingIMDb()		  If MovieAttr.ID_IMDB <> "" Then ShowURL "http://www.imdb.com/title/" + MovieAttr.ID_IMDB		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub ShowListingTMDB()		  If MovieAttr.ID_TMDB <> "" Then ShowURL "http://www.themoviedb.org/movie/" + MovieAttr.ID_TMDB		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub ShowListingWiki()		  If ActiveListbox = wndMain.lstMovies Then ShowURL( "http://" + Prefs.textStringForKey("DBLanguage") + ".wikipedia.org/wiki/" + MovieAttr.Title.ReplaceAll( " ", "_" ) + "_(film)" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub SortByNextAired()		  If ActiveListbox = wndMain.lstTVShows Then Prefs.integerForKey("SortByTV") = 3		  SortList		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub SortByPath()		  If ActiveListbox = wndMain.lstMovies  Then Prefs.integerForKey("SortByMovie") = 2		  If ActiveListbox = wndMain.lstTVShows Then Prefs.integerForKey("SortByTV" )   = 2		  SortList		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub SortByPremiereDate()		  If ActiveListbox = wndMain.lstMovies Then Prefs.integerForKey("SortByMovie") = 4		  SortList		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub SortByQuality()		  If ActiveListbox = wndMain.lstMovies Then Prefs.integerForKey("SortByMovie") = 5		  SortList		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub SortByRating()		  If ActiveListbox = wndMain.lstMovies  Then Prefs.integerForKey("SortByMovie") = 6		  If ActiveListbox = wndMain.lstTVShows Then Prefs.integerForKey("SortByTV")    = 4		  SortList		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub SortByStudio()		  If ActiveListbox = wndMain.lstMovies  Then Prefs.integerForKey("SortByMovie") = 7		  If ActiveListbox = wndMain.lstTVShows Then Prefs.integerForKey("SortByTV")    = 5		  SortList		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub SortByTitle()		  If ActiveListbox = wndMain.lstMovies  Then Prefs.integerForKey("SortByMovie") = 0		  If ActiveListbox = wndMain.lstTVShows Then Prefs.integerForKey("SortByTV" )   = 0		  SortList		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub SortByTitleSort()		  If ActiveListbox = wndMain.lstMovies  Then Prefs.integerForKey("SortByMovie") = 1		  If ActiveListbox = wndMain.lstTVShows Then Prefs.integerForKey("SortByTV" )   = 1		  SortList		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub SortByWatchedStatus()		  If ActiveListbox = wndMain.lstMovies Then Prefs.integerForKey("SortByMovie") = 3		  SortList		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub SortList()		  If ActiveListbox = wndMain.lstMovies Then wndMain.lstMovies.SortList		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub UpdateAllImages()		  Dim Scrapeditems as Integer = 0		  For i as Integer = 0 to ActiveListbox.ListCount - 1		    If ActiveListbox.Cell(i, 2) <> "" Then Scrapeditems = Scrapeditems + 1		  Next		  		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kDownloading + ":", "...", Scrapeditems, "UpdateMovieImages" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub UpdateAllMovieRatings()		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kSearching + ":", "...", 0, "UpdateAllMovieRatings" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub UpdateMetadata()		  If MsgDlg( wndMain, 1, _		    Loc.msgUpdate.ReplaceAll( "%F", SectionName.Lowercase ), _		    Loc.msgWhatWillBeUpdated.ReplaceAll( "%F", SectionName.Lowercase ), _		    Loc.dlgOK, Loc.dlgCancel ) = 2 Then Return		    		    Dim ScrapedItems as Integer = 0		    For i as Integer = 0 to ActiveListbox.ListCount - 1		      If ActiveListbox.Cell(i, 2) <> "" Then ScrapedItems = ScrapedItems + 1		    Next		    		    If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kDownloading + ":", "...", ScrapedItems, "UpdateMovies" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub UpdateSingleImages()		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kDownloading + ":", "...", 11, "UpdateSingleMovieImages" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub UpdateSingleMovieRating()		  If ActiveListbox = wndMain.lstMovies Then dlgProgress.Start( Loc.kSearching + ":", CurrentMovieName + " " + Loc.mRating.ReplaceAll(":", "..."), 4, "UpdateSingleMovieRating" )		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub WatchMovie()		  Dim MovieFile as FolderItem = FindMovieItem( MovieAttr.FolderParent )		  If MovieFile <> Nil And MovieFile.Exists Then MovieFile.Launch		End Sub	#tag EndMethod	#tag Method, Flags = &h1		Protected Sub WatchTrailer()		  If ActiveListbox = wndMain.lstMovies Then		    Dim TrailerItem as FolderItem = FindTrailerItem( MovieAttr.FolderParent )		    If TrailerItem <> Nil And TrailerItem.Exists Then TrailerItem.Launch Else MsgBox Loc.msgNoTrailer		  End If		End Sub	#tag EndMethod	#tag Property, Flags = &h1		Protected SectionName As String	#tag EndProperty	#tag ViewBehavior		#tag ViewProperty			Name="Index"			Visible=true			Group="ID"			InitialValue="-2147483648"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Left"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Name"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Super"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Top"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty	#tag EndViewBehaviorEnd Module#tag EndModule