#tag WindowBegin Window wndSetManager2   BackColor       =   &hFFFFFF   Backdrop        =   ""   CloseButton     =   True   Composite       =   False   Frame           =   0   FullScreen      =   False   HasBackColor    =   False   Height          =   5.2e+2   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   32000   MenuBar         =   ""   MenuBarVisible  =   True   MinHeight       =   64   MinimizeButton  =   True   MinWidth        =   64   Placement       =   3   Resizeable      =   True   Title           =   "Set Manager"   Visible         =   True   Width           =   5.72e+2   Begin Listbox lstSetMovies      AutoDeactivate  =   True      AutoHideScrollbars=   True      Bold            =   ""      Border          =   True      ColumnCount     =   3      ColumnsResizable=   ""      ColumnWidths    =   "80%,0%,20%"      DataField       =   ""      DataSource      =   ""      DefaultRowHeight=   22      Enabled         =   True      EnableDrag      =   True      EnableDragReorder=   ""      GridLinesHorizontal=   0      GridLinesVertical=   0      HasHeading      =   False      HeadingIndex    =   -1      Height          =   452      HelpTag         =   ""      Hierarchical    =   False      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   ""      Italic          =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      RequiresSelection=   ""      Scope           =   0      ScrollbarHorizontal=   ""      ScrollBarVertical=   True      SelectionType   =   0      TabIndex        =   0      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   12      TextUnit        =   0      Top             =   14      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   300      _ScrollWidth    =   -1   End   Begin Listbox lstSets      AutoDeactivate  =   True      AutoHideScrollbars=   True      Bold            =   ""      Border          =   True      ColumnCount     =   1      ColumnsResizable=   ""      ColumnWidths    =   ""      DataField       =   ""      DataSource      =   ""      DefaultRowHeight=   22      Enabled         =   True      EnableDrag      =   ""      EnableDragReorder=   True      GridLinesHorizontal=   0      GridLinesVertical=   0      HasHeading      =   False      HeadingIndex    =   -1      Height          =   452      HelpTag         =   ""      Hierarchical    =   True      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   ""      Italic          =   ""      Left            =   332      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   True      RequiresSelection=   ""      Scope           =   0      ScrollbarHorizontal=   ""      ScrollBarVertical=   True      SelectionType   =   0      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   12      TextUnit        =   0      Top             =   14      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   220      _ScrollWidth    =   -1   End   Begin AddRemoveButtons arSet      AcceptFocus     =   ""      AcceptTabs      =   ""      AutoDeactivate  =   True      Backdrop        =   ""      DoubleBuffer    =   False      Enabled         =   True      EraseBackground =   True      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   332      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   False      Scope           =   0      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      Top             =   478      UseFocusRing    =   True      Visible         =   True      Width           =   45   End   Begin SuperTextfield txtSet      AcceptTabs      =   ""      Alignment       =   0      AutoComplete    =   ""      AutoDeactivate  =   True      AutomaticallyCheckSpelling=   False      BackColor       =   &hFFFFFF      Bold            =   ""      Border          =   True      CueText         =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Format          =   ""      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      Italic          =   ""      Left            =   389      LimitText       =   0      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   False      Mask            =   ""      Password        =   ""      ReadOnly        =   ""      Scope           =   0      TabIndex        =   3      TabPanelIndex   =   0      TabStop         =   True      Text            =   ""      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   478      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   163   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Sub Close()		  wndMain.lstMovies.CreateList		End Sub	#tag EndEvent	#tag Event		Sub Open()		  Dim icns as new IconMBS( "fold", "MACS" )		  FolderIcon = icns.IconFamily.Small32BitData		  FolderIcon.Mask = icns.IconFamily.Small8BitMask		  		  RefreshSetMovieList		End Sub	#tag EndEvent	#tag MenuHandler		Function FileCloseWindow() As Boolean Handles FileCloseWindow.Action			Close			Return True					End Function	#tag EndMenuHandler	#tag Method, Flags = &h0		Sub AddSet(row as Integer, order as Integer = 0)		  If Row <= -1 Then Return		  		  Dim f as FolderItem = GetFolderItem( lstSetMovies.Cell( lstSetMovies.ListIndex, 1 ) )		  If f <> Nil and f.Exists Then MovieAttr.NFORead( f )		  		  MovieAttr.Set = lstSets.Cell( row, 0 )		  MovieAttr.SetOrder = order		  		  f = FindNFOFile( f )		  If f <> Nil and f.Exists Then MovieAttr.NFOWrite( f )		  		  lstSetMovies.Cell( lstSetMovies.ListIndex, 2 ) = MovieAttr.Set + "" + str( order )		  RefreshSetsList		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub RefreshSetMovieList()		  lstSetMovies.DeleteAllRows		  		  Dim lstbox as Listbox = wndMain.lstMovies		  For i as Integer = 0 to lstbox.ListCount - 1		    If lstbox.Cell( i, 2 ) <> "" Then lstSetMovies.AddRow lstbox.Cell( i, 0 ), lstbox.Cell( i, 1 ), lstbox.Cell( i, 9 )		    lstSetMovies.RowPicture( lstSetMovies.LastIndex ) = miniconmovie		  Next		  		  RefreshSetsList		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub RefreshSetsList()		  lstSets.DeleteAllRows		  		  Dim Sets() as String		  Dim i as Integer		  		  For i = 0 to lstSetMovies.ListCount - 1		    If lstSetMovies.Cell( i, 2 ) <> "" Then Sets.Append lstSetMovies.Cell( i, 2 ).NthField( "", 1 )		  Next		  		  Sets.Sort		  		  For i = Sets.Ubound to 1 Step - 1		    If Sets(i) = Sets(i-1) Then Sets.Remove(i)		  Next i		  		  For i = 0 to Sets.Ubound		    lstSets.AddFolder Sets(i)		    lstSets.RowTag( lstSets.LastIndex ) = "Folder"		    lstSets.CellBold( lstSets.LastIndex, 0 ) = True		    lstSets.RowPicture( lstSets.LastIndex ) = FolderIcon		    lstSets.Expanded( lstSets.LastIndex ) = True		  Next		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub RemoveSet(row as Integer)		  Dim f as FolderItem = GetFolderItem( lstSetMovies.Cell( row, 1 ) )		  If f <> Nil and f.Exists Then MovieAttr.NFORead( f )		  		  MovieAttr.Set = ""		  MovieAttr.SetOrder = -1		  		  f = FindNFOFile( f )		  If f <> Nil and f.Exists Then MovieAttr.NFOWrite( f )		  		  		  'RefreshSetsList		End Sub	#tag EndMethod	#tag Property, Flags = &h0		DroppedIndex As Integer	#tag EndProperty	#tag Property, Flags = &h0		FolderIcon As Picture	#tag EndProperty#tag EndWindowCode#tag Events lstSetMovies	#tag Event		Function DragRow(drag As DragItem, row As Integer) As Boolean		  drag.Text = Me.Cell( row, 0 )		  drag.DragPicture = miniconmovie		  Return True		End Function	#tag EndEvent	#tag Event		Sub Open()		  #If NOT DebugBuild Then Me.ColumnWidths = "100%, 0, 0"		End Sub	#tag EndEvent#tag EndEvents#tag Events lstSets	#tag Event		Sub ExpandRow(row As Integer)		  		  For i as Integer = 0 to lstSetMovies.ListCount - 1		    If lstSetMovies.Cell(i, 2).NthField( "", 1 ) = Me.Cell( row, 0 ) Then		      Me.AddRow lstSetMovies.Cell( i, 0 )		      Me.RowPicture( Me.LastIndex ) = miniconmovie		    End If		  Next		End Sub	#tag EndEvent	#tag Event		Sub Change()		  arSet.RemoveEnabled = Me.ListIndex > -1 '( Me.ListIndex > -1 And lstSets.RowTag( lstSets.ListIndex ) <> "Folder" )		End Sub	#tag EndEvent	#tag Event		Sub Open()		  me.AcceptTextDrop		End Sub	#tag EndEvent	#tag Event		Sub DropObject(obj As DragItem, action As Integer)		  If obj.TextAvailable Then AddSet DroppedIndex		  MouseCursor = System.Cursors.StandardPointer		End Sub	#tag EndEvent	#tag Event		Function DragOver(x As Integer, y As Integer, obj As DragItem, action As Integer) As Boolean		  If NOT obj.TextAvailable Then Return False		  		  Dim HoverIndex as Integer		  If Y >= -1 and Floor( Y / Me.RowHeight ) <= Me.ListCount -1 Then		    		    MouseCursor = System.Cursors.Copy		    		    For i as Integer = 0 to Floor( Y / Me.RowHeight )		      If Me.RowTag( i ) = "Folder" Then Me.ListIndex = i		    Next		    		  Else // Out of bounds		    Me.ListIndex = -1		    MouseCursor = System.Cursors.StandardPointer		  End If		  		  Me.Refresh		  DroppedIndex = me.ListIndex		End Function	#tag EndEvent	#tag Event		Sub DragExit(obj As DragItem, action As Integer)		  Me.ListIndex = -1		  Me.Refresh		  MouseCursor = System.Cursors.StandardPointer		End Sub	#tag EndEvent	#tag Event		Function CellBackgroundPaint(g As Graphics, row As Integer, column As Integer) As Boolean		  'If Me.Active Then g.ForeColor = rgb(211, 217, 225) Else g.ForeColor = rgb(236, 236, 236)		  'g.FillRect( 0, 0, me.Width, me.Height )		End Function	#tag EndEvent#tag EndEvents#tag Events arSet	#tag Event		Sub ActionAdd()		  If txtSet.Text = "" Then Return		  Dim b as Boolean = False		  		  For i as Integer = 0 to lstSets.ListCount - 1		    If lstSets.RowTag(i) = "Folder" and lstSets.Cell( i, 0 ) = txtSet.Text Then b = True		  Next		  		  If b Then Return		  		  lstSets.AddFolder( txtSet.Text )		  lstSets.RowTag( lstSets.LastIndex ) = "Folder"		  lstSets.RowPicture( lstSets.LastIndex )   = FolderIcon		  lstSets.CellType(   lstSets.LastIndex, 0) = lstSets.TypeEditable		  		  txtSet.Text = ""		End Sub	#tag EndEvent	#tag Event		Sub ActionRemove()		  If lstSets.RowTag( lstSets.ListIndex ) = "Folder" Then		    		    For i as Integer = 0 to lstSetMovies.ListCount - 1		      If lstSetMovies.Cell( i, 2 ).NthField( "", 1 ) = lstSets.Cell( lstSets.ListIndex, 0 ) Then		        lstSetMovies.Cell( i, 2 ) = ""		        RemoveSet i		      End If		    Next		    		  Else		    		    For i as Integer = 0 to lstSetMovies.ListCount - 1		      If lstSets.Cell( lstSets.ListIndex, 0 ) = lstSetMovies.Cell( i, 0 ) Then		        lstSetMovies.Cell( i, 2 ) = ""		        RemoveSet i		      End If		    Next		    		  End If		  		  RefreshSetsList		End Sub	#tag EndEvent#tag EndEvents#tag Events txtSet	#tag Event		Sub TextChange()		  arSet.AddEnabled = me.Text <> ""		End Sub	#tag EndEvent	#tag Event		Sub Open()		  arSet.AddEnabled = me.Text <> ""		End Sub	#tag EndEvent	#tag Event		Function KeyDown(Key as String) As Boolean		  If Keyboard.AsyncKeyDown( &h4C ) or Keyboard.AsyncKeyDown( &h24 ) then		    If Me.Active and Me.Text <> "" then arSet.PushAdd		    Me.Text = ""		  End If		End Function	#tag EndEvent#tag EndEvents