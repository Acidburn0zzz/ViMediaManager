#tag WindowBegin Window wndArtPreview   BackColor       =   &hFFFFFF   Backdrop        =   ""   CloseButton     =   True   Composite       =   False   Frame           =   1   FullScreen      =   False   HasBackColor    =   False   Height          =   600   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   32000   MenuBar         =   ""   MenuBarVisible  =   True   MinHeight       =   220   MinimizeButton  =   False   MinWidth        =   400   Placement       =   3   Resizeable      =   True   Title           =   "Preview"   Visible         =   True   Width           =   900   Begin ThumbViewer cvsThumbs      AcceptFocus     =   ""      AcceptTabs      =   ""      AutoDeactivate  =   True      Backdrop        =   ""      Columns         =   ""      DoubleBuffer    =   False      Enabled         =   True      EraseBackground =   True      Height          =   548      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   0      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      Rows            =   ""      Scope           =   0      Selection       =   ""      TabIndex        =   0      TabPanelIndex   =   0      TabStop         =   True      ThumbSize       =   128      Top             =   0      UseFocusRing    =   True      Visible         =   True      Width           =   884   End   Begin ScrollBar scrThumbs      AcceptFocus     =   true      AutoDeactivate  =   True      Enabled         =   True      Height          =   548      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   884      LineStep        =   1      LiveScroll      =   True      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   True      Maximum         =   0      Minimum         =   0      PageStep        =   20      Scope           =   0      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      Top             =   0      Value           =   0      Visible         =   True      Width           =   16   End   Begin PushButton btnDownload      AutoDeactivate  =   True      Bold            =   ""      ButtonStyle     =   0      Cancel          =   ""      Caption         =   "#Localizable.kDownload"      Default         =   True      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   780      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   False      Scope           =   0      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   560      Underline       =   ""      Visible         =   True      Width           =   100   End   Begin PushButton btnCancel      AutoDeactivate  =   True      Bold            =   ""      ButtonStyle     =   0      Cancel          =   True      Caption         =   "#localizable.dlgCancel"      Default         =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   688      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   False      Scope           =   0      TabIndex        =   3      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   560      Underline       =   ""      Visible         =   True      Width           =   80   End   Begin Label lblSize      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   54      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      Multiline       =   ""      Scope           =   0      Selectable      =   False      TabIndex        =   4      TabPanelIndex   =   0      TabStop         =   True      Text            =   1000      TextAlign       =   2      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   560      Transparent     =   False      Underline       =   ""      Visible         =   True      Width           =   46   End   Begin Slider sldThumbSize      AutoDeactivate  =   True      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   112      LineStep        =   1      LiveScroll      =   True      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   False      Maximum         =   1000      Minimum         =   32      PageStep        =   32      Scope           =   0      TabIndex        =   5      TabPanelIndex   =   0      TabStop         =   True      TickStyle       =   0      Top             =   560      Value           =   128      Visible         =   True      Width           =   564   End   Begin Separator Sep      AutoDeactivate  =   True      Enabled         =   True      Height          =   1      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   0      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   False      Scope           =   0      TabIndex        =   6      TabPanelIndex   =   0      TabStop         =   True      Top             =   548      Visible         =   True      Width           =   900   End   Begin ProgressWheel pgWheel      AutoDeactivate  =   True      Enabled         =   True      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      Scope           =   0      TabIndex        =   7      TabPanelIndex   =   0      TabStop         =   True      Top             =   560      Visible         =   False      Width           =   22   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Sub Close()		  Preferences.SaveWindowPos( Self, "wndArtPreview" )		End Sub	#tag EndEvent	#tag Event		Function KeyDown(Key As String) As Boolean		  // If cvsThumbs.Selection = 0 or cvsThumbs.Selection = cvsThumbs.Thumbs.Ubound then Return False		  Dim Sel as Integer = cvsThumbs.Selection		  		  // Up		  If Keyboard.AsyncKeyDown( &h7E ) then		    If Sel <= cvsThumbs.Columns then		      Sel = 0		    Else		      Sel = Sel - cvsThumbs.Columns		    End If		  End If		  		  // Down		  If Keyboard.AsyncKeyDown( &h7D ) then		    If Sel >= cvsThumbs.Thumbs.Ubound - cvsThumbs.Columns then		      Sel = cvsThumbs.Thumbs.Ubound		    Else		      Sel = Sel + cvsThumbs.Columns		    End If		  End If		  		  // Right		  If Keyboard.AsyncKeyDown( &h7C ) and Sel < cvsThumbs.Thumbs.Ubound then Sel = Sel + 1		  		  // Left		  If Keyboard.AsyncKeyDown( &h7B ) and Sel > 0 then Sel = Sel - 1		  		  cvsThumbs.Selection = Sel		  cvsThumbs.Invalidate False		  		  'cvsThumbs.ScrollTop = 50		  'scrThumbs.Value = 50		End Function	#tag EndEvent	#tag Event		Sub Open()		  Preferences.LoadWindowPos( Self, "wndArtPreview" )		End Sub	#tag EndEvent	#tag Method, Flags = &h1		Protected Sub SaveImage()		  Dim ImageDestination, ImageFile as FolderItem		  Dim Pic as Picture		  Dim Type, Title as String		  		  Select Case wndMain.ppMain.Value		  case 0		    ImageDestination = MovieAttr.FolderParent		    Title = MovieAttr.Title		  case 1		    'ImageDestination = TVAttr.FolderParent		    'Title = TVAttr.Title		  case 2		    'ImageDestination = AnimeAttr.FolderParent		    'Title = AnimeAttr.Title		  End Select		  		  btnDownload.Enabled = False		  btnCancel.Enabled = False		  		  pgWheel.Visible = True		  		  Select case Mode		    		    // Movies@TMDB		  case "TMDB-Poster"		    ImageFile = MovieAttr.DestinationPoster( ImageDestination )		    Type = Localizable.kPoster		    		  case "TMDB-Fanart"		    ImageFile = MovieAttr.DestinationFanart( ImageDestination )		    Type = Localizable.kFanart		    		    		    // Movies@FanartTV		  case "FanartTV-MovieDisc"		    ImageFile = ImageDestination.Child("disc.png")		    Type = Localizable.kDiscArt		    		  case "FanartTV-MovieArt"		    ImageFile = ImageDestination.Child("clearart.png")		    Type = "Clear Art"		    		  case "FanartTV-MovieLogo"		    ImageFile = ImageDestination.Child("logo.png")		    Type = Localizable.kLogo		    		    		    // Series@FanartTV		  case "FanartTV-ClearArt"		    ImageFile = ImageDestination.Child("clearart.png")		    Type = "Clear Art"		    		  case "FanartTV-ClearLogo"		    ImageFile = ImageDestination.Child("logo.png")		    Type = Localizable.kLogo		    		  case "FanartTV-CharacterArt"		    ImageFile = ImageDestination.Child("characterart.png")		    Type = "Character Art"		    		  case "FanartTV-TVThumb"		    ImageFile = ImageDestination.Child("landscape.jpg")		    Type = Localizable.kTVThumb		    		  case "FanartTV-SeasonThumb"		    ImageFile = ImageDestination.Child("season-all.jpg")		    Type = Localizable.kSeasonThumb		    		  End Select		  		  If ImageFile <> Nil and ImageFile.Exists and MsgDlg( Nil, 1, msgPriorArtFound.ReplaceAll("<image>", Type.Lowercase).ReplaceAll("<title>", Title), msgPriorArtDeletion.ReplaceAll("<image>", Type.Lowercase), Localizable.dlgReplace, Localizable.dlgCancel ) = 1 Then		    ImageFile.MoveFileToTrash		  End If		  		  If ImageFile  = Nil or NOT ImageFile.Exists and ImageDestination.Exists Then _		  Pic = URL2Picture( Scrape.ArtURL( cvsThumbs.Selection ), ImageFile.NameWithoutExtension, ImageFile.NameExtension, ImageDestination )		  		  Select Case Mode		  case "TMDB-Poster"		    MovieAttr.ART_Poster = Pic		    CacheImageSet( MovieAttr.ART_Poster, MovieAttr.ID_IMDB + ".movie.poster.jpg" )		  case "TMDB-Fanart"		    MovieAttr.ART_Fanart= Pic		    CacheImageSet( MovieAttr.ART_Fanart, MovieAttr.ID_IMDB + ".movie.fanart.jpg" )		  End Select		  		  If wndMain.ppMain.Value = 0 then		    wndMain.lstMovies.UpdateRow		    // MsgBox MovieAttr.FolderParent.Name		    MovieAttr.LoadImages( MovieAttr.FolderParent )		    wndMain.cvsMovies.Invalidate( True )		  End If		  		  pgWheel.Visible = False		End Sub	#tag EndMethod	#tag Property, Flags = &h0		Mode As String	#tag EndProperty	#tag Constant, Name = msgPriorArtDeletion, Type = String, Dynamic = True, Default = \"Would you like to replace your existing <image> file with the chosen image\?", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Would you like to replace your existing <image> file with the chosen image\?"		#Tag Instance, Platform = Any, Language = nl, Definition  = \"Wil je het bestaande <image> bestand vervangen met het gekozen plaatjes\?"	#tag EndConstant	#tag Constant, Name = msgPriorArtFound, Type = String, Dynamic = True, Default = \"ViMediaManager has found an existing <image> file for \'<title>\'.", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"ViMediaManager has found an existing <image> file for \'<title>\'."		#Tag Instance, Platform = Any, Language = nl, Definition  = \"ViMediaManager heeft een al bestaande <image> bestand gevonden voor \'<title>\'."	#tag EndConstant#tag EndWindowCode#tag Events cvsThumbs	#tag Event		Sub ThumbsChanged(ThumbsAmount as Integer)		  Self.Title = Str( ThumbsAmount ) + " " + Localizable.kImages		End Sub	#tag EndEvent	#tag Event		Sub RowsChanged(RowAmount as Integer)		  If Me.Height < ( Me.ThumbSize + 12.5 ) * ( RowAmount + 1 ) then		    scrThumbs.Maximum  = ( ( Me.ThumbSize + 12.5 ) * ( RowAmount + 1 ) ) - Me.Height		  Else		    scrThumbs.Maximum = 0		  End If		  		  scrThumbs.PageStep = ( Me.ThumbSize + 12.5 ) * ( Me.Height / ( Me.ThumbSize + 12.5 ) )		  scrThumbs.LineStep = ( Me.ThumbSize + 12.5 ) / 10		End Sub	#tag EndEvent	#tag Event		Sub MouseDrag(X as Integer, Y as Integer)		  If Y < Me.Top and scrThumbs.Value > 0 then scrThumbs.Value = scrThumbs.Value - ( Me.ThumbSize / 10 )		  If Y > Me.Top + Me.Height and scrThumbs.Value < scrThumbs.Maximum then scrThumbs.Value = scrThumbs.Value + ( Me.ThumbSize / 10 )		End Sub	#tag EndEvent	#tag Event		Sub DoubleClick(X As Integer, Y As Integer)		  If cvsThumbs.Selection > -1 then		    btnDownload.Push		  Else		    // No selection.		  End If		  		  Close		End Sub	#tag EndEvent	#tag Event		Function MouseWheel(X As Integer, Y As Integer, deltaX as Integer, deltaY as Integer) As Boolean		  'Self.Title = str( x ) + "x " + str( y ) + "y " + str( deltaX ) + "Dx " + str( deltaY ) + "Dy"		  scrThumbs.Value = scrThumbs.Value + ( deltaY * 8 )		  sldThumbSize.Value = sldThumbSize.Value + ( DeltaX * 2 )		End Function	#tag EndEvent	#tag Event		Sub SelectionChanged(Sel As Integer, Row as Integer = -1, Column as Integer = -1)		  'If Row <= -1 And Column <= -1 Then Return		  '		  'Dim i as Integer = ( ( Row * Me.ThumbSize ) - 25 ) '12.5 ) )		  'Dim t as Integer = i + Me.Height		  'If Row * ( Me.ThumbSize ) < t And scrThumbs.Value > i Then		  'scrThumbs.Value = i		  'ElseIf ( Row * Me.ThumbSize ) + Me.ThumbSize > t And scrThumbs.Value < i Then		  'scrThumbs.Value = i		  'End If		End Sub	#tag EndEvent#tag EndEvents#tag Events scrThumbs	#tag Event		Sub ValueChanged()		  cvsThumbs.ScrollTop = Me.Value		  cvsThumbs.Invalidate False		End Sub	#tag EndEvent#tag EndEvents#tag Events btnDownload	#tag Event		Sub Action()		  If cvsThumbs.Selection > -1 then SaveImage		  Scrape.ClearArts		  Self.Close		  		  If wndMain.ppMain.Value = 0 then // Movies		    MovieAttr.LoadImages( MovieAttr.FolderParent )		    wndMain.cvsMovies.Invalidate( True )		    		  ElseIf wndMain.ppMain.Value = 1 then // TV Shows		  ElseIf wndMain.ppMain.Value = 2 then // Anime		  End If		End Sub	#tag EndEvent#tag EndEvents#tag Events btnCancel	#tag Event		Sub Action()		  Scrape.ClearArts		  Close		End Sub	#tag EndEvent#tag EndEvents#tag Events lblSize	#tag Event		Sub Open()		  Me.text = Str( Prefs.integerForKey( "PreviewThumbSize" ) )		End Sub	#tag EndEvent#tag EndEvents#tag Events sldThumbSize	#tag Event		Sub ValueChanged()		  cvsThumbs.ThumbSize = me.Value		  Prefs.integerForKey( "PreviewThumbSize" ) = Me.Value		  cvsThumbs.Invalidate False		  		  lblSize.Text = Str( Me.Value )		End Sub	#tag EndEvent	#tag Event		Sub Open()		  Me.Value = Prefs.integerForKey( "PreviewThumbSize" )		End Sub	#tag EndEvent#tag EndEvents