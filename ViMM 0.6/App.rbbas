#tag ClassProtected Class AppInherits Application	#tag Event		Sub Close()		  Preferences.WriteDefaults		End Sub	#tag EndEvent	#tag Event		Sub Open()		  If Keyboard.AsyncAltKey then App.DebugMode = True		  RegisterMBS		  		  HelpAbout.Text = Menu.HelpAbout + App.kAppName		  		  LoadDefaults		  Growl.Register		  		  VersionCurrent = str( App.MajorVersion ) + "." + str( App.MinorVersion )		  if App.BugVersion > 0 then VersionCurrent = VersionCurrent + str( App.BugVersion )		  if App.StageCode = 2  then VersionCurrent = VersionCurrent + "b" + str( App.NonReleaseVersion )		  		  InitializeSparkle("http://vidalvanbergen.github.com/ViMediaManager/appcast.xml")		End Sub	#tag EndEvent	#tag MenuHandler		Function EditPreferences() As Boolean Handles EditPreferences.Action			wndPreferences.Show			Return True					End Function	#tag EndMenuHandler	#tag MenuHandler		Function HelpAbout() As Boolean Handles HelpAbout.Action			wndAbout.Show			Return True					End Function	#tag EndMenuHandler	#tag MenuHandler		Function HelpCheckforUpdates() As Boolean Handles HelpCheckforUpdates.Action			Sparkle.CheckForUpdates(True)			Return True					End Function	#tag EndMenuHandler	#tag MenuHandler		Function HelpDonate() As Boolean Handles HelpDonate.Action			ShowURL DonationURL			Return True					End Function	#tag EndMenuHandler	#tag Method, Flags = &h21		Private Function HandleSparkleCancelQuit() As Boolean		  Return True		End Function	#tag EndMethod	#tag Method, Flags = &h21		Private Sub HandleSparkleFoundVersion(isNew as Boolean, version as String)		  Dim Major, Minor, Bug, Stage, NonRelease As Integer = 0		  Dim VersionPart() as String = Version.Split(".")		  		  Major = Val( VersionPart(0) )		  If VersionPart.Ubound >= 1 then Minor      = Val( VersionPart(1) )		  If VersionPart.Ubound >= 2 then Bug        = Val( VersionPart(2) )		  If VersionPart.Ubound >= 3 then Stage      = Val( VersionPart(3) )		  If VersionPart.Ubound >= 4 then NonRelease = Val( VersionPart(4) )		  		  VersionNew = str( Major ) + "." + str( Minor )		  If Bug > 0   then VersionNew = VersionNew + "." + str( Bug )		  If Stage = 2 Then VersionNew = VersionNew + "b" + str( NonRelease )		  		  VersionNew = Version		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub InitializeSparkle(FeedURL as String)		  #If TargetMacOS Then		    //You can pass a FolderItem for Sparkle.framework, or you can pass nil.  In this case, Sparkle will look for Sparkle.framework		    //in the Frameworks subdirectory of the app bundle, in ~/Library/Frameworks, and in /Library/Frameworks.		    		    //setting this will prevent problems with unhandled NSExceptions		    Sparkle.UserDefault("SUFeedURL") = FeedURL		    		    dim SparkleFrameworkLocation as FolderItem = nil		    Sparkle.Initialize SparkleFrameworkLocation		    Sparkle.FoundVersionHandler = AddressOf HandleSparkleFoundVersion		    Sparkle.CancelQuitHandler   = AddressOf HandleSparkleCancelQuit		    		    Sparkle.CheckStatus		  #EndIf		End Sub	#tag EndMethod	#tag Property, Flags = &h0		DebugMode As Boolean = False	#tag EndProperty	#tag Property, Flags = &h0		VersionCurrent As String	#tag EndProperty	#tag Property, Flags = &h0		VersionNew As String	#tag EndProperty	#tag Constant, Name = DonationURL, Type = String, Dynamic = False, Default = \"https://www.paypal.com/cgi-bin/webscr\?cmd\x3D_donations&business\x3Dvidal%2evanbergen%40gmail%2ecom&lc\x3DGB&item_name\x3DViMediaManager&currency_code\x3DEUR&bn\x3DPP%2dDonationsBF%3abtn_donateCC_LG%2egif%3aNonHosted", Scope = Public	#tag EndConstant	#tag Constant, Name = Identifier, Type = String, Dynamic = False, Default = \"com.vidalvanbergen.vimediamanager", Scope = Public	#tag EndConstant	#tag Constant, Name = kAppName, Type = String, Dynamic = False, Default = \"ViMediaManager", Scope = Public	#tag EndConstant	#tag Constant, Name = kEditClear, Type = String, Dynamic = False, Default = \"&Delete", Scope = Public		#Tag Instance, Platform = Windows, Language = Default, Definition  = \"&Delete"		#Tag Instance, Platform = Linux, Language = Default, Definition  = \"&Delete"	#tag EndConstant	#tag Constant, Name = kFileQuit, Type = String, Dynamic = False, Default = \"&Quit", Scope = Public		#Tag Instance, Platform = Windows, Language = Default, Definition  = \"E&xit"	#tag EndConstant	#tag Constant, Name = kFileQuitShortcut, Type = String, Dynamic = False, Default = \"", Scope = Public		#Tag Instance, Platform = Mac OS, Language = Default, Definition  = \"Cmd+Q"		#Tag Instance, Platform = Linux, Language = Default, Definition  = \"Ctrl+Q"	#tag EndConstant	#tag Constant, Name = XBMCForumURL, Type = String, Dynamic = False, Default = \"http://forum.xbmc.org/showthread.php\?p\x3D886768", Scope = Public	#tag EndConstant	#tag ViewBehavior		#tag ViewProperty			Name="DebugMode"			Group="Behavior"			InitialValue="False"			Type="Boolean"		#tag EndViewProperty		#tag ViewProperty			Name="VersionCurrent"			Group="Behavior"			Type="String"			EditorType="MultiLineEditor"		#tag EndViewProperty		#tag ViewProperty			Name="VersionNew"			Group="Behavior"			Type="String"			EditorType="MultiLineEditor"		#tag EndViewProperty	#tag EndViewBehaviorEnd Class#tag EndClass