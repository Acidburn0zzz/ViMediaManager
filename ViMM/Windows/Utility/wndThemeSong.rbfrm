#tag WindowBegin Window wndThemeSong   BackColor       =   &hFFFFFF   Backdrop        =   ""   CloseButton     =   True   Composite       =   True   Frame           =   0   FullScreen      =   False   HasBackColor    =   False   Height          =   1.62e+2   ImplicitInstance=   True   LiveResize      =   False   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   32000   MenuBar         =   ""   MenuBarVisible  =   True   MinHeight       =   64   MinimizeButton  =   False   MinWidth        =   64   Placement       =   3   Resizeable      =   False   Title           =   "#Loc.kThemeSong"   Visible         =   True   Width           =   6.0e+2   Begin Canvas cvsLogoArt      AcceptFocus     =   ""      AcceptTabs      =   ""      AutoDeactivate  =   True      Backdrop        =   ""      DoubleBuffer    =   False      Enabled         =   True      EraseBackground =   True      Height          =   32      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   20      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   0      TabPanelIndex   =   0      TabStop         =   True      Top             =   14      UseFocusRing    =   True      Visible         =   True      Width           =   32   End   Begin PopupMenu popThemeSongs      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   ""      Italic          =   ""      Left            =   64      ListIndex       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   80      Underline       =   ""      Visible         =   True      Width           =   424   End   Begin Label lblArray      AutoDeactivate  =   True      Bold            =   True      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   0      InitialParent   =   ""      Italic          =   ""      Left            =   64      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      Multiline       =   ""      Scope           =   0      Selectable      =   False      TabIndex        =   2      TabPanelIndex   =   0      Text            =   "Choose a themesong:"      TextAlign       =   0      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   14      Transparent     =   False      Underline       =   ""      Visible         =   True      Width           =   218   End   Begin Label lblArray      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   22      HelpTag         =   ""      Index           =   1      InitialParent   =   ""      Italic          =   ""      Left            =   64      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Multiline       =   True      Scope           =   0      Selectable      =   False      TabIndex        =   3      TabPanelIndex   =   0      Text            =   "Downloading a theme song will replace the exising theme song."      TextAlign       =   0      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   46      Transparent     =   False      Underline       =   ""      Visible         =   True      Width           =   516   End   Begin PushbuttonPro btnPreview      AutoDeactivate  =   True      Bold            =   ""      ButtonStyle     =   0      Cancel          =   ""      Caption         =   "#Loc.kPreview"      Default         =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   500      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   4      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   80      Underline       =   ""      Visible         =   True      Width           =   80   End   Begin ccCancelSave CancelSave      AcceptFocus     =   ""      AcceptTabs      =   True      AutoDeactivate  =   True      BackColor       =   &hFFFFFF      Backdrop        =   ""      Enabled         =   True      EraseBackground =   True      HasBackColor    =   False      Height          =   22      HelpTag         =   ""      InitialParent   =   ""      Left            =   380      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   5      TabPanelIndex   =   0      TabStop         =   True      Top             =   120      UseFocusRing    =   ""      Visible         =   True      Width           =   200   End   Begin HTTPSocket SndSocket      Address         =   ""      Height          =   32      Index           =   -2147483648      Left            =   7      LockedInPosition=   False      Port            =   0      Scope           =   0      TabPanelIndex   =   0      Top             =   186      Width           =   32      yield           =   0   End   Begin ProgressBar prgBar      AutoDeactivate  =   True      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   64      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Maximum         =   0      Scope           =   0      TabPanelIndex   =   0      Top             =   120      Value           =   0      Visible         =   False      Width           =   304   End   Begin MoviePlayer sndPlayer      AutoDeactivate  =   True      AutoPlay        =   True      AutoResize      =   False      Border          =   False      Controller      =   2      HasStep         =   True      Height          =   16      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   62      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Looping         =   ""      Movie           =   ""      Palindrome      =   ""      PlayerType      =   1      Scope           =   0      Speaker         =   True      TabIndex        =   8      TabPanelIndex   =   0      TabStop         =   True      Top             =   120      Visible         =   False      Width           =   304   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Sub Close()		  SndSocket.Close		End Sub	#tag EndEvent	#tag Event		Sub Open()		  'HTMLPlayer = New HTMLViewer		End Sub	#tag EndEvent	#tag MenuHandler		Function FileCloseWindow() As Boolean Handles FileCloseWindow.Action			Self.Close			Return True					End Function	#tag EndMenuHandler	#tag Property, Flags = &h0		Closing As Boolean = False	#tag EndProperty#tag EndWindowCode#tag Events cvsLogoArt	#tag Event		Sub Paint(g As Graphics, areas() As REALbasic.Rect)		  'If App.ScalingFactor < 2 Then Return		  		  If App.ScalingFactor = 1 Then Me.Backdrop = tb_themesong		  		  g.ScaleImage( tb_themesong2x, g.Width, g.Height )		End Sub	#tag EndEvent#tag EndEvents#tag Events btnPreview	#tag Event		Sub Action()		  		  sndPlayer.Visible = False		  'sndPlayer.Border = False		  'sndPlayer.HasStep = True		  'sndPlayer.Speaker = True		  sndPlayer.Refresh		  		  // Stop player		  If Me.Caption = Loc.dlgStop Then		    sndPlayer.Stop		    sndPlayer.Movie = Nil		    		    Me.Caption = Loc.kPreview		    sndPlayer.Refresh		    Return		  End If		  		  // Play Local		  If popThemeSongs.RowTag( popThemeSongs.ListIndex ) = TVAttr.FolderParent.Child( "theme.mp3" ).AbsolutePath And TVAttr.FolderParent.Child( "theme.mp3" ).Exists Then		    sndPlayer.Visible = True		    Me.Caption = Loc.dlgStop		    sndPlayer.movie = TVAttr.FolderParent.Child( "theme.mp3" ).OpenAsMovie		    		    sndPlayer.Play		    sndPlayer.Refresh		    Return		  End If		  		  // Play URL		  If Me.Caption = Loc.kPreview Then		    SndSocket.Yield = True		    prgBar.Visible = True		    If NOT DebugBuild Then Me.Enabled = False		    		    SndSocket.Get( popThemeSongs.RowTag( popThemeSongs.ListIndex ), SpecialFolder.Temporary.Child("theme.mp3") )		    sndPlayer.Refresh		    Return		  End If		End Sub	#tag EndEvent#tag EndEvents#tag Events CancelSave	#tag Event		Sub ActionCancel()		  Self.Close		End Sub	#tag EndEvent	#tag Event		Sub ActionOK()		  // If the selected theme was selected, just close		  sndPlayer.Movie = Nil		  sndPlayer.Visible = False		  Closing = True		  		  If popThemeSongs.RowTag( popThemeSongs.ListIndex ) = TVAttr.FolderParent.Child( "theme.mp3" ).AbsolutePath Then		    Self.Close		    Return		  End If		  		  // Ask if they want to remove the existing Theme.		  If TVAttr.FolderParent.Child( "theme.mp3" ).Exists Then		    If MsgDlg( Self, 1, Loc.msgDeleteThemeSong, Loc.kCantBeUndone, Loc.kDelete, Loc.dlgCancel ) = 1 Then		      TVAttr.FolderParent.Child( "theme.mp3" ).MoveFileToTrash		    Else		      Return		    End If		  End If		  prgBar.Visible = True		  		  // Set URL		  Dim URL as String = Trim( popThemeSongs.RowTag( popThemeSongs.ListIndex ) )		  If URL = "" And TVAttr.ThemeSongs.Ubound > -1 Then URL = TVAttr.ThemeSongs(0)		  If URL = "" Then Return		  		  // Get URL		  'Dim sckt as New TVDBSckt		  If SndSocket.Get( URL, SpecialFolder.Temporary.Child( "theme.mp3" ), Prefs.integerForKey("TimeOut") ) Then		    SpecialFolder.Temporary.Child( "theme.mp3" ).MoveFileTo( TVAttr.FolderParent.Child( "theme.mp3" ) )		    'MsgBox Loc.kDownloadComplete		  Else		    MsgBox Loc.kNothingLeft		  End If		  prgBar.Visible = False		  		  If ActiveSection = 1 Then wndMain.lstTVShows.UpdateRow		  Self.Close		End Sub	#tag EndEvent#tag EndEvents#tag Events SndSocket	#tag Event		Sub DownloadComplete(url as string, httpStatus as integer, headers as internetHeaders, file as folderItem)		  'File.ShowInFinder		  If NOT Closing Then		    btnPreview.Caption = Loc.dlgStop		    btnPreview.Enabled = True		    prgBar.Visible = False		    sndPlayer.Visible = True		    		    sndPlayer.Movie = File.OpenAsMovie		    sndPlayer.Play		    Me.Close		  End if		End Sub	#tag EndEvent	#tag Event		Sub ReceiveProgress(bytesReceived as integer, totalBytes as integer, newData as string)		  		  If prgBar.Maximum <> totalBytes Then prgBar.Maximum = totalBytes		  prgBar.Value = bytesReceived		End Sub	#tag EndEvent#tag EndEvents