#tag WindowBegin Window wndSearchMovies   BackColor       =   &hFFFFFF   Backdrop        =   ""   CloseButton     =   True   Composite       =   False   Frame           =   1   FullScreen      =   False   HasBackColor    =   False   Height          =   5.0e+2   ImplicitInstance=   True   LiveResize      =   False   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   32000   MenuBar         =   ""   MenuBarVisible  =   True   MinHeight       =   64   MinimizeButton  =   False   MinWidth        =   64   Placement       =   3   Resizeable      =   False   Title           =   "#wTitle"   Visible         =   True   Width           =   900   Begin ListboxPRO lstResults      AlternatingRows =   True      AutoDeactivate  =   True      AutoHideScrollbars=   True      Bold            =   ""      Border          =   True      ColumnCount     =   15      ColumnsResizable=   False      ColumnWidths    =   "100%"      DataField       =   ""      DataSource      =   ""      DefaultRowHeight=   22      Enabled         =   True      EnableDrag      =   ""      EnableDragReorder=   ""      GridLinesHorizontal=   0      GridLinesVertical=   0      HasHeading      =   False      HeadingIndex    =   -1      Height          =   413      HelpTag         =   ""      Hierarchical    =   False      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   ""      Italic          =   ""      Left            =   0      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   False      LockTop         =   True      RequiresSelection=   True      Scope           =   0      ScrollbarHorizontal=   ""      ScrollBarVertical=   True      SelectionGradient=   True      SelectionType   =   0      SourceList      =   False      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   12      TextUnit        =   0      Top             =   33      TypeToSearch    =   True      Underline       =   ""      UseFocusRing    =   False      Visible         =   True      Width           =   300      _ScrollWidth    =   -1   End   Begin ccSearch ccSearchMovies      AcceptFocus     =   ""      AcceptTabs      =   True      AutoDeactivate  =   True      BackColor       =   16777215      Backdrop        =   ""      Enabled         =   True      EraseBackground =   True      HasBackColor    =   False      Height          =   33      HelpTag         =   "#kUseIMDBID"      InitialParent   =   ""      Left            =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   False      LockTop         =   True      Scope           =   0      TabIndex        =   0      TabPanelIndex   =   0      TabStop         =   True      Top             =   0      UseFocusRing    =   False      Visible         =   True      Width           =   300   End   Begin ccCancelSave CancelSave      AcceptFocus     =   ""      AcceptTabs      =   True      AutoDeactivate  =   True      BackColor       =   &hFFFFFF      Backdrop        =   ""      Enabled         =   True      EraseBackground =   True      HasBackColor    =   False      Height          =   22      HelpTag         =   ""      InitialParent   =   ""      Left            =   708      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   False      Scope           =   0      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      Top             =   458      UseFocusRing    =   ""      Visible         =   True      Width           =   172   End   Begin Canvas cvsInfo      AcceptFocus     =   ""      AcceptTabs      =   ""      AutoDeactivate  =   True      Backdrop        =   ""      DoubleBuffer    =   False      Enabled         =   True      EraseBackground =   True      Height          =   446      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   300      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      Scope           =   0      TabIndex        =   3      TabPanelIndex   =   0      TabStop         =   True      Top             =   0      UseFocusRing    =   True      Visible         =   True      Width           =   600   End   Begin MovieSckt scktTMDB      Address         =   ""      Height          =   32      Index           =   -2147483648      InitialParent   =   ""      Left            =   20      LockedInPosition=   False      Port            =   0      Scope           =   0      TabPanelIndex   =   0      Top             =   512      Width           =   32      yield           =   0   End   Begin ProgressWheel prgWheel      AutoDeactivate  =   True      Enabled         =   True      Height          =   16      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   658      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   4      TabPanelIndex   =   0      TabStop         =   True      Top             =   461      Visible         =   False      Width           =   16   End   Begin Thread ThrSearchResult      Height          =   32      Index           =   -2147483648      Left            =   64      LockedInPosition=   False      Priority        =   5      Scope           =   0      StackSize       =   0      TabPanelIndex   =   0      Top             =   512      Width           =   32   End   Begin PopupArrow popWeb      AutoDeactivate  =   True      Enabled         =   True      Facing          =   1      Height          =   10      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   686      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   5      TabPanelIndex   =   0      TabStop         =   True      Top             =   464      Visible         =   True      Width           =   10   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Sub Close()		  scktTMDB.Close		  ThrSearchResult.Kill		End Sub	#tag EndEvent	#tag MenuHandler		Function FileCloseWindow() As Boolean Handles FileCloseWindow.Action			Close			Return True					End Function	#tag EndMenuHandler	#tag Method, Flags = &h0		Sub QuickDecode(JSONString as String)		  scktTMDB.Yield = True		  		  // pFanart = Nil		  // pPoster = Nil		  		  If NOT JSONString.ValidJSON("TMDB-Search") Then Return		  		  Dim JSON as New JSONItem		  JSON.Load JSONString		  If JSON.HasName("status_message") Then		    pIMDBID   = lstResults.Cell(lstResults.ListIndex, 1)		    pTagline  = lstResults.Cell(lstResults.ListIndex, 2)		    pPremiere = lstResults.Cell(lstResults.ListIndex, 3)		    pDuration = lstResults.Cell(lstResults.ListIndex, 6)		    pPlot     = lstResults.Cell(lstResults.ListIndex, 8)		    Return		  End If		  		  pPlot     = JSON.Value("overview")		  pTagline  = JSON.Value("tagline")		  pDuration = JSON.Value("runtime")		  pPremiere = JSON.Value("release_date")		  pIMDBID   = JSON.Value("imdb_id")		  		  For i as Integer = 0 To JSON.Child("genres").Count - 1		    If i = JSON.Child("genres").Count -1 Then		      pGenres = pGenres + JSON.Child("genres").Child(i).Value("name")		    Else		      pGenres = pGenres + JSON.Child("genres").Child(i).Value("name") + ", "		    End If		  Next		  		End Sub	#tag EndMethod	#tag Property, Flags = &h0		LastIndex As Integer = -1	#tag EndProperty	#tag Property, Flags = &h0		pDuration As String	#tag EndProperty	#tag Property, Flags = &h0		pFanart As Picture	#tag EndProperty	#tag Property, Flags = &h0		pGenres As String	#tag EndProperty	#tag Property, Flags = &h0		pIMDBID As String	#tag EndProperty	#tag Property, Flags = &h0		pPlot As String	#tag EndProperty	#tag Property, Flags = &h0		pPoster As Picture	#tag EndProperty	#tag Property, Flags = &h0		pPremiere As String	#tag EndProperty	#tag Property, Flags = &h0		pTagline As String	#tag EndProperty	#tag Constant, Name = kSearchFieldHelpText, Type = String, Dynamic = True, Default = \"Movie title (year) or IMDb ID", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Movie title (year) or IMDb ID"		#Tag Instance, Platform = Any, Language = nl, Definition  = \"Film titel (jaar) of IMDb ID"	#tag EndConstant	#tag Constant, Name = kUseIMDBID, Type = String, Dynamic = True, Default = \"Instead of key words\x2C you can also use an IMDb ID to search for a movie.", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Instead of key words\x2C you can also use an IMDb ID to search for a movie."		#Tag Instance, Platform = Any, Language = nl, Definition  = \"In plaats van sleutelwoorden\x2C kunt u ook een IMDb ID gebruiken om te zoeken naar een film."	#tag EndConstant	#tag Constant, Name = wTitle, Type = String, Dynamic = True, Default = \"Search Movies", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Search Movies"		#Tag Instance, Platform = Any, Language = nl, Definition  = \"Zoek Films"	#tag EndConstant#tag EndWindowCode#tag Events lstResults	#tag Event		Function KeyDown(Key As String) As Boolean		  If Keyboard.AsyncKeyDown( &h4C ) or Keyboard.AsyncKeyDown( &h24 ) then // Pressed Enter		    If Me.ListIndex > -1 then CancelSave.btnRight.Push		  ElseIf Keyboard.AsyncKeyDown( &h35 ) then // Pressed Escape		    CancelSave.btnLeft.Push		  End If		End Function	#tag EndEvent	#tag Event		Sub DoubleClick()		  If Me.ListIndex > -1 Then CancelSave.btnRight.Push		End Sub	#tag EndEvent	#tag Event		Sub Change()		  ThrSearchResult.Kill		  ThrSearchResult.Run		  		  #If TargetLinux Then		    scktTMDB.Yield = True		    		    If Me.ListIndex = -1 Then Return		    		    		    If LastIndex = me.ListIndex Then Return		    		    scktTMDB.Disconnect		    scktTMDB.Close		    scktTMDB.Flush		    		    prgWheel.Visible = True		    		    pPoster = Nil		    pFanart = Nil		    		    pPlot    = ""		    pGenres  = ""		    pTagline = ""		    pIMDBID  = ""		    pDuration = ""		    pPremiere = ""		    		    cvsInfo.Refresh		    		    		    // ---- Load Info		    Dim JSONString as String		    		    If lstResults.Cell( lstResults.ListIndex, 7 ) <> "" Then JSONString = lstResults.Cell( lstResults.ListIndex, 7 )		    		    If JSONString = "" And lstResults.Cell( lstResults.ListIndex, 1 ) <> "" Then		      JSONString = DefineEncoding( scktTMDB.Get( scktTMDB.URL( "MovieInfo", lstResults.Cell( lstResults.ListIndex, 1 ), Prefs.textStringForKey("DBLanguage") ), Prefs.integerForKey("TimeOut" ) ), Encodings.UTF8 )		      If JSONString.ValidJSON Then lstResults.Cell( lstResults.ListIndex, 7 ) = JSONString		    End If		    		    QuickDecode ConvertEncoding( JSONString, Encodings.UTF8 )		    		    cvsInfo.Refresh		    		    // ---- Load Images		    		    // Poster		    Dim s as String = lstResults.Cell( lstResults.ListIndex, 5 )		    		    If lstResults.Cell( lstResults.ListIndex, 4 ) <> "" And lstResults.Cell( lstResults.ListIndex, 4 ).Left(4) = "http" Then		      pPoster = Picture.FromData( scktTMDB.Get( lstResults.Cell( lstResults.ListIndex, 4 ), 0 ) )		      scktTMDB.Close		    End If		    		    // Fanart		    If lstResults.Cell( lstResults.ListIndex, 5 ) <> "" And lstResults.Cell( lstResults.ListIndex, 5 ).Left(4) = "http" Then		      pFanart = Picture.FromData( scktTMDB.Get( lstResults.Cell( lstResults.ListIndex, 5 ), 0 ) )		      scktTMDB.Close		    End If		    		    		    cvsInfo.Refresh		    		    prgWheel.Visible = False		    		    LastIndex = Me.ListIndex		  #EndIf		End Sub	#tag EndEvent#tag EndEvents#tag Events ccSearchMovies	#tag Event		Sub DoSearch(SearchText as String)		  If Trim(SearchText) = "" Then Return		  LastIndex = -1		  		  If SearchText.Left(2) = "tt" Or SearchText.Left(2) = "id:" Then		    Self.Close		    dlgProgress.ScrapeMovie( SearchText.ReplaceAll("id:",""), lstResults.Cell( lstResults.ListIndex, 0 ) )		  Else		    'dlgProgress.Start( Loc.kSearching + ":", SearchText, 0, "SelectedMovie" )		    'MovieCore.MovieSearch( SearchText, True )		    dlgProgress.Start( Loc.kSearching + ":", SearchText, 0, "ManualSearchMovie" )		  End If		End Sub	#tag EndEvent	#tag Event		Function KeyDown(Key As String) As Boolean		  If Asc(Key) = 13 Then Return True		End Function	#tag EndEvent	#tag Event		Sub ResetSearch()		  Me.edtSearch.Text = ""		End Sub	#tag EndEvent	#tag Event		Sub Open()		  Me.edtSearch.CueText = kSearchFieldHelpText		End Sub	#tag EndEvent#tag EndEvents#tag Events CancelSave	#tag Event		Sub ActionCancel()		  dlgProgress.Close		  Close		End Sub	#tag EndEvent	#tag Event		Sub ActionOK()		  // TO DO		  		  Dim ID as String   = lstResults.Cell( lstResults.ListIndex, 1 )		  Dim Name as String = lstResults.Cell( lstResults.ListIndex, 0 )		  dlgProgress.Close		  Close		  		  If PriorArtFound( MovieAttr.FolderParent ) And _		    MsgDlg( Nil, 1, MovieCore.msgPriorMovieArtFound.ReplaceAll( "<movie>", CurrentMovieName ), MovieCore.msgPriorArtDeletion, MovieCore.btnReplaceExistingArtwork, MovieCore.btnDownloadMissingArtwork ) = 1 Then		    PriorArtDelete( MovieAttr.FolderParent )		  End If		  		  dlgProgress.ScrapeMovie( ID, Name )		End Sub	#tag EndEvent	#tag Event		Sub Open()		  me.btnRight.Default = False		End Sub	#tag EndEvent#tag EndEvents#tag Events cvsInfo	#tag Event		Sub Paint(g As Graphics)		  // Background		  g.ForeColor = &cFFFFFF		  g.FillRect 0, 0, me.Width, me.Height		  		  If lstResults.ListIndex > -1 Then		    		    		    // ## Backdrop		    Dim Backdrop as Picture = lstResults.CellTag( lstResults.ListIndex, 5 )		    If Backdrop = Nil Then Backdrop = IMGmovies		    		    If Backdrop <> Nil Then		      Dim Factor as Double = Min( Me.Width / Backdrop.Width, Me.Height / Backdrop.Height )		      Dim Pic as New Picture( Backdrop.Width * Factor, Backdrop.Height * Factor, 32 )		      'g.ScaleImage Backdrop, Pic.Width, Pic.Height, 0, 0		      g.DrawPicture Backdrop, 0, 0, Pic.Width, Pic.Height, 0, 0, Backdrop.Width, Backdrop.Height		      g.DrawPicture IMGFanartOverlay, 0, 0, Pic.Width, Pic.Height, 0, 0, IMGFanartOverlay.Width, IMGFanartOverlay.Height		      		      'Dim Pic as New Picture( me.Width, me.Height, 32 )		      'Pic = ScaleImage( Backdrop, Pic.Width, Pic.Height, True, True, False )		      'Pic.Graphics.DrawPicture IMGFanartOverlay, 0, 0, Pic.Width, Pic.Height, 0, 0, IMGFanartOverlay.Width, IMGFanartOverlay.Height		      'g.DrawPicture Pic, 0, 0		    End If		    		    // ## Poster		    Dim Poster as Picture = lstResults.CellTag( lstResults.ListIndex, 4 )		    If Poster <> Nil Then		      g.DrawPicture posterbg, -32, 2		      g.DrawPicture Poster, 53 - 32, 16 + 2, 145, 217, 0, 0, Poster.Width, Poster.Height		    End If		    		    Dim TextTop as Integer = 13		    Dim TextLeft as Integer = 20		    If Poster <> Nil Then TextLeft = 184		    		    Dim Title as String = lstResults.Cell( lstResults.ListIndex, 0 )		    Dim DateYear as Integer = Val( lstResults.Cell( lstResults.ListIndex, 3 ).Left(4) )		    If DateYear < 1000 Then DateYear = Val( lstResults.Cell( lstResults.ListIndex, 3 ).Right(4) )		    If DateYear < 1000 Then DateYear = 0		    		    g.TextSize = 16		    g.Bold = True		    TextTop = TextTop + g.TextSize		    		    // ## Write Title		    'If Title <> "" And DateYear > 0 Then		    '		    ''Dim YearLeft as Integer = TextLeft + g.StringWidth( Title )		    'Dim DisplayTitle as String = Title		    'If DateYear > 0 Then DisplayTitle = Title + " (" + Str( DateYear ) + ")"		    '		    ''g.ForeColor = &c000000		    ''g.Transparency = 40		    ''g.DrawString " (" + Str( DateYear ) + ")", YearLeft, TextTop - 1 // Year - Shadow		    ''g.Transparency = 0		    '		    'g.ForeColor = &cFFFFFF		    'g.DrawString DisplayTitle, TextLeft, TextTop + 1, Me.Width - TextLeft - 20, False // Title - HiLite		    ''If DateYear > -1 Then g.DrawString " (" + Str( DateYear ) + ")", YearLeft, TextTop + 1 // Year - HiLite		    '		    'g.ForeColor = &c333333		    'g.DrawString DisplayTitle, TextLeft, TextTop, Me.Width - TextLeft - 20, False // Title		    '		    ''g.ForeColor = &c999999		    ''If DateYear > -1 Then g.DrawString " (" + Str( DateYear ) + ")", YearLeft, TextTop // Year		    '		    'TextTop = TextTop + g.StringHeight( DisplayTitle, Me.Width - TextLeft - 20 )		    'Else		    If Title <> "" Then		      g.ForeColor  = &cFFFFFF		      g.DrawString Title, TextLeft, TextTop + 1, Me.Width - TextLeft - 20, False		      		      g.ForeColor  = &c333333		      g.DrawString Title, TextLeft, TextTop, Me.Width - TextLeft - 20, False		      		      TextTop = TextTop + g.StringHeight( Title, Me.Width - TextLeft - 20 )		    End If		    		    		    		    g.Bold     = False		    g.Italic   = True		    g.TextSize = 12		    		    		    // ## Write Tagline		    Dim Tagline as String = lstResults.Cell( lstResults.ListIndex, 7 )		    If Tagline <> "" Then		      g.ForeColor = &cFFFFFF		      g.DrawString Tagline, TextLeft, TextTop + 1, Me.Width - TextLeft - 20, False		      g.ForeColor = &c333333		      g.DrawString Tagline, TextLeft, TextTop,     Me.Width - TextLeft - 20, False		      		      TextTop = TextTop + 4 + g.StringHeight( Tagline, Me.Width - TextLeft - 20 )		    End If		    		    		    // ## Write Duration - Genre(s) - Premiere		    Dim SubTagline as String		    g.Italic = False		    		    Dim Duration as String = lstResults.Cell( lstResults.Listindex, 9 )		    Dim Genres   as String = lstResults.Cell( lstResults.ListIndex, 10 )		    Dim Premiere as String = lstResults.Cell( lstResults.ListIndex, 3 )		    		    // Duration		    If Val( Duration ) > 0 Then		      Dim h as Integer = Floor( Val( Duration ) / 60 )		      Dim m as Integer = Val( Duration ) - ( h * 60 )		      		      Dim Hours, Minutes as String = ""		      If h > 0 Then Hours   = Str(h) + "h "		      If m > 0 Then Minutes = Str(m) + "m "		      		      SubTagline = Hours + Minutes + "- "		    End If		    		    // Genre(s)		    If Genres <> "" Then SubTagline = SubTagline + Trim( Genres.ReplaceAll(", ", " | ") ) + " "		    		    // Premiere		    If SubTagline <> "" Then SubTagline = SubTagline + "- "		    If Premiere <> "" Then SubTagline = SubTagline + PrettyDate( Premiere, True )		    		    // Write		    If SubTagline <> "" Then		      g.Bold = True		      		      g.ForeColor = &cFFFFFF		      g.DrawString SubTagline, TextLeft, TextTop + 1, Me.Width - TextLeft - 20, True		      		      g.ForeColor = &c555555		      g.DrawString SubTagline, TextLeft, TextTop,     Me.Width - TextLeft - 20, True		      		      g.Bold = False		      		      TextTop = TextTop + ( 18 * 2 )		    End If		    		    // ## Write Plot		    Dim Plot as String = lstResults.Cell( lstResults.Listindex, 8 )		    If Plot <> "" Then		      		      g.ForeColor = &cFFFFFF		      g.DrawString Plot, TextLeft, TextTop + 1, Me.Width - TextLeft - 20, False		      		      g.ForeColor = &c333333		      g.DrawString Plot, TextLeft, TextTop, Me.Width - TextLeft - 20, False		      		      TextTop = TextTop + g.StringHeight( Plot, Me.Width - TextLeft - 20 ) + 12		    End If		    		    '// ## Rating		    'Dim Rating as Double = Val( lstResults.Cell( lstResults.ListIndex, 11 ) )		    'g.ForeColor = &cFFFFFF		    'g.Bold = True		    'g.TextSize = 28		    '		    'If Rating > 0 Then		    'g.DrawPicture( ScaleImage( metatagsrating, 75, 50 ), 20, me.Height - 50 - 11 )		    '		    'Dim s as Integer = g.StringWidth( Str( Rating ) )		    'g.DrawString( Str( Rating ), 20 + ( (75/2) - (s/2) ), Me.Height - 50 - 11 + ( 50 - 14 ) )		    ''TagsLeft = TagsLeft + 80		    'End If		    Dim path as String = MovieAttr.FolderParent.ShellPath.ReplaceAll("\","")		    g.ForeColor = &cFFFFFF		    g.DrawString path, 20, Me.Height - g.StringHeight( path, Me.Width )		    		    g.ForeColor = &c666666		    g.DrawString path, 20, Me.Height - g.StringHeight( path, Me.Width )		    		  End If		  		  // Borders		  g.ForeColor = &cC3C3C3		  g.DrawLine 0, 0, me.Width, 0		  g.DrawLine 0, me.Height - 1, me.Width, me.Height - 1		End Sub	#tag EndEvent#tag EndEvents#tag Events ThrSearchResult	#tag Event		Sub Run()		  Dim ID as String = lstResults.Cell( lstResults.ListIndex, 1 )		  Dim Lang as String = Prefs.textStringForKey("DBLanguage")		  		  prgWheel.Visible = False		  scktTMDB.Yield = True		  scktTMDB.Close		  		  If lstResults.ListIndex = -1 Then Return		  prgWheel.Visible = True		  		  // If no previous data has been fetched.		  If lstResults.CellTag( lstResults.ListIndex, 4 ) = Nil Or _		    lstResults.CellTag( lstResults.ListIndex, 5 ) = Nil Then		    		    // ## Local JSON		    Dim JSONString as String = DefineEncoding( scktTMDB.Get( scktTMDB.URL("MovieInfo", lstResults.Cell( lstResults.ListIndex, 1 ), Prefs.textStringForKey("DBLanguage") ), Prefs.integerForKey("TimeOut") ), Encodings.UTF8 )		    scktTMDB.Close		    JSONString = DecodingFromHTMLMBS( JSONString )		    		    Dim TMDBLocal as New JSONItem		    If JSONString.ValidJSON("TMDB Local") Then TMDBLocal.Load JSONString		    JSONString = ""		    		    // ## US JSON		    Dim TMDBUS as New JSONItem		    If NOT TMDBLocal.HasName("status_message") And Lang.instr( 0, "en" ) = 0 Then		      JSONString = DefineEncoding( scktTMDB.Get( scktTMDB.URL("MovieInfo", lstResults.Cell( lstResults.ListIndex, 1 ), "en" ), Prefs.integerForKey("TimeOut") ), Encodings.UTF8 )		      If JSONString.ValidJSON("TMDB US") Then TMDBUS.load JSONString		      JSONString = ""		    End If		    		    // ## IMDb		    If ID.Left(2) <> "tt" And TMDBLocal.HasName("imdb_id") And TMDBLocal.Value("imdb_id") <> "" Then ID = TMDBLocal.Value("imdb_id")		    Dim IMDb as New JSONItem		    If ID.Left(2) = "tt" Then		      'JSONString = DefineEncoding( IMDBjson( ID, True ), Encodings.UTF8 )		      'If JSONString.ValidJSON( "IMDb" ) Then IMDB.Load DecodingFromHTMLMBS( JSONString.ReplaceAll("&#x27;","'").ReplaceAll("&#x22;","\""").ReplaceAll("&#x26;","&") )		    End If		    		    // :0 = Display Title		    // :1 = ID		    // :2 = Title		    Dim Cell as String = lstResults.Cell( lstResults.ListIndex, 2 )		    Dim DisplayTitle as String		    		    If TMDBUS.HasName("titel")    And TMDBUS.Value("title")    <> "" Then DisplayTitle = TMDBUS.Value("title")		    If TMDBLocal.HasName("title") And TMDBLocal.Value("title") <> "" Then DisplayTitle = TMDBLocal.Value("title")		    If IMDb.HasName("TITLE")      And IMDb.Value("TITLE")      <> "" Then DisplayTitle = IMDb.Value("TITLE")		    		    If Cell <> DisplayTitle Then lstResults.Cell( lstResults.ListIndex, 2 ) = DisplayTitle		    // :3 = Release Date		    If IMDb.HasName("RELEASE_DATE")      And IMDb.Value("RELEASE_DATE")      <> "" Then lstResults.Cell( lstResults.ListIndex, 3 ) = IMDb.Value("RELEASE_DATE")		    If TMDBUS.HasName("release_date")    And TMDBUS.Value("release_date")    <> "" Then lstResults.Cell( lstResults.ListIndex, 3 ) = TMDBUS.Value("release_date")		    If TMDBLocal.HasName("release_date") And TMDBLocal.Value("release_date") <> "" Then lstResults.Cell( lstResults.ListIndex, 3 ) = TMDBLocal.Value("release_date")		    // :4 = PosterURL		    Dim PosterURL as String   = lstResults.Cell( lstResults.ListIndex, 4 )		    // :5 = BackdropURL		    Dim BackdropURL as String = lstResults.Cell( lstResults.ListIndex, 5 )		    // :6 = IMDb ID		    If TMDBLocal.HasName("imdb_id") and TMDBLocal.Value("imdb_id") <> "" Then lstResults.Cell( lstResults.ListIndex, 6 ) = TMDBLocal.Value("imdb_id")		    // :7 = Tagline		    If TMDBUS.HasName("tagline")    And TMDBUS.value("tagline")    <> "" Then lstResults.Cell( lstResults.ListIndex, 7 ) = TMDBUS.Value("tagline") // U.S. Backup		    If IMDb.HasName("TAGLINE")      And IMDb.Value("TAGLINE")      <> "" Then lstResults.Cell( lstResults.ListIndex, 7 ) = IMDb.Value("TAGLINE")		    If TMDBLocal.HasName("tagline") And TMDBLocal.Value("tagline") <> "" Then lstResults.Cell( lstResults.ListIndex, 7 ) = TMDBLocal.Value("tagline") // Local		    // :8 = Plot		    If TMDBUS.HasName("overview")    And TMDBUS.Value("overview")    <> "" Then lstResults.Cell( lstResults.ListIndex, 8 ) = TMDBUS.Value("overview") // U.S. Backup		    If IMDb.HasName("STORYLINE")     And IMDb.Value("STORYLINE")     <> "" Then lstResults.Cell( lstResults.ListIndex, 8 ) = IMDb.Value("STORYLINE")		    If TMDBLocal.HasName("overview") And TMDBLocal.Value("overview") <> "" Then lstResults.Cell( lstResults.ListIndex, 8 ) = TMDBLocal.Value("overview") // Local		    // :9 = Runtime		    If TMDBUS.HasName("runtime")     And TMDBUS.Value("runtime")     <> "" Then lstResults.Cell( lstResults.ListIndex, 9 ) = TMDBUS.Value("runtime")		    // :10 = Genres		    If TMDBLocal.HasName("genres") And TMDBLocal.Child("genres").Count > 0 Then		      Dim genres as String		      For i as Integer = 0 To TMDBLocal.Child("genres").Count - 1		        If i = 3 Then Exit		        If genres = "" Then		          genres = TMDBLocal.Child("genres").Child(i).Value("name")		        Else		          genres = genres + " | " + TMDBLocal.Child("genres").Child(i).Value("name")		        End If		      Next		      lstResults.Cell( lstResults.ListIndex, 10 ) = genres		    End If		    // :11 = Rating		    If TMDBUS.HasName("vote_average") And TMDBUS.Value("vote_average") <> "" Then lstResults.Cell( lstResults.ListIndex, 11 ) = Str( Round( TMDBUS.Value("vote_average") * 10 ) / 10 )		    If IMDb.HasName("RATING")         And IMDb.Value("RATING")         <> "" Then lstResults.Cell( lstResults.ListIndex, 11 ) = Str( IMDb.Value("RATING") )		    // :12 = Original Title		    Dim CellOT as String		    If TMDBLocal.HasName("original_title") And TMDBLocal.Value("original_title") <> "" Then CellOT = TMDBLocal.Value("original_title")		    If IMDb.HasName("TITLE")               And IMDb.Value("TITLE")               <> "" Then CellOT = IMDb.Value("TITLE")		    If IMDb.HasName("ORIGINAL_TITLE")      And IMDb.Value("ORIGINAL_TITLE")      <> "" Then CellOT = IMDb.Value("ORIGINAL_TITLE")		    'If Lang.InStr(0, "en") = 0 And Country = "Asia" And IMDb.HasName("AKA") And IMDb.Value("AKA") <> "" Then CellOT = IMDb.Value("AKA")		    If TMDBUS.HasName("title") And TMDBUS.Value("title") <> "" Then CellOT = TMDBUS.Value("title")		    		    lstResults.Cell( lstResults.ListIndex, 12 ) = CellOT		    // :13 = MPAA Rating		    Dim MPAA as String		    If IMDb.HasName("MPAA_RATING") And IMDb.Value("MPAA_RATING") = "" Then MPAA = "-"		    If IMDb.HasName("MPAA_RATING")         And IMDb.Value("MPAA_RATING")         <> "" Then MPAA = IMDb.Value("MPAA_RATING")		    Dim sx2 as Integer = MPAA.InStr(0, " for ")		    If sx2 > 0 Then MPAA = Trim( MPAA.Left( sx2 ) )		    lstResults.Cell( lstResults.ListIndex, 13 ) = MPAA		    		    // :14 = Homepage		    If TMDBUS.HasName("homepage")    And TMDBUS.Value("homepage")    <> "" Then lstResults.Cell( lstResults.ListIndex, 14 ) = TMDBUS.Value("homepage")		    If TMDBLocal.HasName("homepage") And TMDBLocal.Value("homepage") <> "" Then lstResults.Cell( lstResults.ListIndex, 14 ) = TMDBLocal.Value("homepage")		    		    		    // Get Poster IMG		    If PosterURL <> "" And PosterURL.Left(4) = "http" Then		      lstResults.CellTag( lstResults.ListIndex, 4 ) = Picture.FromData( scktTMDB.Get( PosterURL, Prefs.IntegerForKey("TimeOut") ) )		    End If		    		    // Get Backdrop IMG		    If BackdropURL <> "" And BackdropURL.Left(4) = "http" Then		      lstResults.CellTag( lstResults.ListIndex, 5 ) = Picture.FromData( scktTMDB.Get( BackdropURL, Prefs.integerForKey("TimeOut") ) )		    End If		    		  End If		  		  		  prgWheel.Visible = False		  cvsInfo.Refresh		  scktTMDB.Close		End Sub	#tag EndEvent#tag EndEvents#tag Events popWeb	#tag Event		Function MouseDown(X As Integer, Y As Integer) As Boolean		  If X > 0 And Y > 0 And _		    X < Me.Width And Y < Me.Width Then		    Return True		  End If		End Function	#tag EndEvent	#tag Event		Sub MouseUp(X As Integer, Y As Integer)		  If X < 0 And Y < 0 And _		    X > Me.Width And Y > Me.Width Then Return		    		    If lstResults.ListIndex = -1 Then Return		    		    Dim imdbID as String = lstResults.Cell( lstResults.ListIndex, 6 )		    Dim tmdbID as String = lstResults.Cell( lstResults.ListIndex, 1 )		    Dim Title  as String = lstResults.Cell( lstResults.ListIndex, 2 )		    Dim TitleOriginal as String = lstResults.Cell( lstResults.ListIndex, 12 )		    Dim ReleaseDate as String = lstResults.Cell( lstResults.ListIndex, 3 )		    Dim HomePageURL as String = lstResults.Cell( lstResults.ListIndex, 13 )		    		    PopUpWebMenu imdbID, tmdbID, Title, TitleOriginal, ReleaseDate, HomePageURL		End Sub	#tag EndEvent#tag EndEvents