#tag ClassProtected Class MainToolbarInherits Toolbar	#tag Event		Sub Action(item As ToolItem)		  Action( item.Name )		End Sub	#tag EndEvent	#tag Event		Sub DropDownMenuAction(item As ToolItem, hitItem As MenuItem)		  '		End Sub	#tag EndEvent	#tag Event		Sub Open()		  ConstructToolbar()		  Open()		End Sub	#tag EndEvent	#tag Method, Flags = &h0		Sub ConstructToolbar()		  _t = New NSToolbar( App.Identifier + ".toolbar", AddressOf ToolbarAction )		  _t.AllowsUserCustomization = True // explicitely tell the toolbar to allow the user to customize the toolbar		  _t.AutosavesConfiguration  = True // this will save the toolbar configuration in user defaults and reload it at subsequent launches		  		  Dim IDs() as String		  IDs.Append "Movies"		  IDs.Append "TVShows"		  IDs.Append "Anime"		  IDs.Append NSToolbarSpaceItemIdentifier		  IDs.Append "FetchMetadata"		  IDs.Append "UpdateMetadata"		  IDs.Append "ManualSearch"		  IDs.Append "Extras"		  IDs.Append "EditMetadata"		  IDs.Append "UpdateList"		  IDs.Append "Clean"		  IDs.Append "SetsManager"		  IDs.Append "EpisodesManager"		  'IDs.Append NSToolbarSpaceItemIdentifier		  IDs.Append NSToolbarFlexibleSpaceItemIdentifier		  IDs.Append "Donate"		  If App.Experimental Then IDs.Append "Experimental"		  IDs.Append wndMainAlt.SearchMedia.Name		  		  _t.DefaultItems = IDs // This is an array of items identifiers to specify the default items (and order) in toolbar		  _t.AllowedItems = IDs // This is an array of items identifiers to specify all the allowed items in toolbar		  		  		  // Show Sections		  tiMovies = New NSToolbarButtonItem( "Movies" )		  tiMovies.Image = tb_movies2x		  tiMovies.ItemLabel = Loc.Movies		  tiMovies.PaletteLabel = kShowMovies		  tiMovies.ToolTip = kShowMovies		  		  _t.AddItem( tiMovies )		  		  tiTVShows = New NSToolbarButtonItem( "TVShows" )		  tiTVShows.Image = tb_television2x		  tiTVShows.ItemLabel = Loc.TVShows		  tiTVShows.PaletteLabel = kShowTVShows		  tiTVShows.ToolTip = kShowTVShows		  		  _t.AddItem( tiTVShows )		  		  tiAnime = New NSToolbarButtonItem( "Anime" )		  tiAnime.Image = tb_anime2x		  tiAnime.ItemLabel = Loc.Anime		  tiAnime.PaletteLabel = kShowAnime		  tiAnime.ToolTip = kShowAnime		  		  tiAnime.Enabled = DebugBuild		  _t.AddItem( tiAnime )		  		  		  // Fetch Metadata		  Dim td as New NSToolbarDropMenuItem( "FetchMetadata" )		  td.Image = tb_fetchall2x		  td.ItemLabel = Loc.FetchMetadata		  td.PaletteLabel = Loc.FetchMetadata		  td.ToolTip = Loc.FetchMetadata		  		  td.AddItem( Loc.kSelection )		  td.AddItem( Loc.kAllMissingMetadata )		  		  _t.AddItem( td )		  		  		  // Update Metadata		  td = New NSToolbarDropMenuItem( "UpdateMetadata" )		  td.Image = tb_fetch2x		  td.ItemLabel = Loc.kUpdateMetadata		  td.PaletteLabel = Loc.kUpdateMetadata		  td.ToolTip = Loc.kUpdateMetadata		  		  _t.AddItem( td )		  		  		  // Manual Search		  Dim ti as New NSToolbarButtonItem( "ManualSearch" )		  ti.Image = tb_search2x		  ti.ItemLabel = Loc.ManualSearch		  ti.PaletteLabel = Loc.ManualSearch		  ti.ToolTip = Loc.ManualSearch		  		  _t.AddItem( ti )		  		  		  // Extras		  ti = New NSToolbarButtonItem( "Extras" )		  ti.Image = tb_extras2x		  ti.ItemLabel = Menu.ToolsExtras		  ti.PaletteLabel = kToolTipDownoadExtras		  ti.ToolTip = kToolTipDownoadExtras		  		  _t.AddItem( ti )		  		  		  // Edit Metadata		  ti = New NSToolbarButtonItem( "EditMetadata" )		  ti.Image = tb_editor2x		  ti.ItemLabel = Loc.kEditMetadata		  ti.PaletteLabel = Loc.kEditMetadata		  ti.ToolTip = kToolTipEditMetadata		  		  _t.AddItem( ti )		  		  		  // Refresh list		  ti = New NSToolbarButtonItem( "UpdateList" )		  ti.Image = tb_refresh2x		  ti.ItemLabel = Loc.Refresh		  ti.PaletteLabel = Loc.Refresh		  ti.ToolTip = Loc.Refresh		  		  _t.AddItem( ti )		  		  		  // Clean		  ti = New NSToolbarButtonItem( "Clean" )		  ti.Image = tb_clean2x		  ti.ItemLabel = Loc.Clean		  ti.PaletteLabel = Loc.Clean		  ti.ToolTip = kToolTipClean		  		  _t.AddItem( ti )		  		  		  // Sets Manager		  tiManagerSets = New NSToolbarButtonItem( "SetsManager" )		  tiManagerSets.Image = tb_setsmanager2x		  tiManagerSets.ItemLabel = Loc.MovieSetsManager		  tiManagerSets.PaletteLabel = Loc.MovieSetsManager		  tiManagerSets.ToolTip = kToolTipManageSets		  		  _t.AddItem( tiManagerSets )		  		  		  // Episodes Manager		  tiManagerEpisodes = New NSToolbarButtonItem( "EpisodesManager" )		  tiManagerEpisodes.Image = tb_episodes2x		  tiManagerEpisodes.ItemLabel = Loc.kEpisodes		  tiManagerEpisodes.PaletteLabel = Loc.kEpisodesManager		  tiManagerEpisodes.ToolTip = kToolTipManageEpisodes		  		  tiManagerEpisodes.Enabled = False		  _t.AddItem( tiManagerEpisodes )		  		  		  // Donate		  ti = New NSToolbarButtonItem( "Donate" )		  ti.Image = tb_donate2x		  ti.ItemLabel = Loc.Donate		  ti.PaletteLabel = Loc.Donate		  ti.ToolTip = kToolTipSupport		  		  _t.AddItem( ti )		  		  		  // Experimental		  ti = New NSToolbarButtonItem( "Experimental" )		  ti.Image = tb_experimental2x		  ti.ItemLabel = Loc.kExperimental		  ti.PaletteLabel = Loc.kExperimental' + " Features"		  ti.ToolTip = Loc.kExperimentalMsg		  		  _t.AddItem( ti )		  		  		  // Search field		  dim maxSize as Cocoa.NSSize // setup structures for max and min size in toolbar (optional but encouraged)		  maxSize.height = 32		  maxSize.width = 200		  dim minSize as Cocoa.NSSize		  minSize.height = 24		  minSize.width = 100		  		  tcSearch = New NSToolbarCustomItem( wndMainAlt.SearchMedia )		  tcSearch.ItemLabel = Loc.kSearch		  tcSearch.PaletteLabel = Loc.kSearchMedia		  tcSearch.ToolTip = kToolTipSearchMedia		  tcSearch.MaxSize = maxSize		  tcSearch.MinSize = minSize		  		  _t.AddItem( tcSearch )		  		  		  // -- Set toolbar		  Me.Window.SetToolbar( _t )		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub SelectSection(Identifier as String)		  // Reset selection		  If Identifier <> "Movies"  Then tiMovies.Image = tb_movies2x      Else tiMovies.Image = tb_moviesselected2x		  If Identifier <> "TVShows" Then tiTVShows.Image = tb_television2x Else tiTVShows.Image = tb_televisionselected2x		  If Identifier <> "Anime"   Then tiAnime.Image = tb_anime2x        Else tiAnime.Image = tb_animeselected2x		End Sub	#tag EndMethod	#tag Method, Flags = &h21		Private Sub ToolbarAction(identifier as String, hitItem as NSMenuItem)		  		  If hitItem <> Nil Then		    DropDownMenuAction( hitItem )		    Return		  End If		  		  Action( identifier )		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub UpdateMetadataMenu(FolderParent as FolderItem)		  tdUpdateMetadata.RemoveAllItems		  		  Dim NFOFile as FolderItem = FindNFOFile( FolderParent )		  		  If NFOFile IsA FolderItem Then		    tdUpdateMetadata.AddItem( Loc.kSelection )		    tdUpdateMetadata.AddItem( Loc.kUpdateRating )		    If True Then // Television section		      tdUpdateMetadata.AddItem( Loc.kUpdateTVShowStatus )		      tdUpdateMetadata.AddItem( Loc.kEpisodes )		    End If		    		    tdUpdateMetadata.AddSeparator		  End If		  		  tdUpdateMetadata.AddItem( Loc.kAll )		  tdUpdateMetadata.AddItem( Menu.FileUpdateRatings )		  If True Then // Television section		    tdUpdateMetadata.AddItem( Menu.FileUpdateShowStatus )		    tdUpdateMetadata.AddItem( Loc.kUpdateEpisodes )		    		    tdUpdateMetadata.AddSeparator		    		    tdUpdateMetadata.AddItem( Loc.kNewEpisodes )		  End If		End Sub	#tag EndMethod	#tag Hook, Flags = &h0		Event Action(identifier as String)	#tag EndHook	#tag Hook, Flags = &h0		Event DropDownMenuAction(hitItem as NSMenuItem)	#tag EndHook	#tag Hook, Flags = &h0		Event Open()	#tag EndHook	#tag Property, Flags = &h0		tcSearch As NSToolbarCustomItem	#tag EndProperty	#tag Property, Flags = &h0		tdFetchMetadata As NSToolbarDropMenuItem	#tag EndProperty	#tag Property, Flags = &h0		tdUpdateMetadata As NSToolbarDropMenuItem	#tag EndProperty	#tag Property, Flags = &h0		tiAnime As NSToolbarButtonItem	#tag EndProperty	#tag Property, Flags = &h0		tiManagerEpisodes As NSToolbarButtonItem	#tag EndProperty	#tag Property, Flags = &h0		tiManagerSets As NSToolbarButtonItem	#tag EndProperty	#tag Property, Flags = &h0		tiMovies As NSToolbarButtonItem	#tag EndProperty	#tag Property, Flags = &h0		tiTVShows As NSToolbarButtonItem	#tag EndProperty	#tag Property, Flags = &h0		_t As NSToolbar	#tag EndProperty	#tag Constant, Name = kShowAnime, Type = String, Dynamic = True, Default = \"Show Anime", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Show Anime"		#Tag Instance, Platform = Any, Language = nl, Definition  = \"Toon Anime"	#tag EndConstant	#tag Constant, Name = kShowMovies, Type = String, Dynamic = True, Default = \"Show Movies", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Show Movies"		#Tag Instance, Platform = Any, Language = nl, Definition  = \"Toon Films"	#tag EndConstant	#tag Constant, Name = kShowTVShows, Type = String, Dynamic = True, Default = \"Show TV Shows", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Show TV Shows"		#Tag Instance, Platform = Any, Language = nl, Definition  = \"Toon TV Series"	#tag EndConstant	#tag Constant, Name = kToolTipClean, Type = String, Dynamic = True, Default = \"Move selected extra media to the trash", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Move selected extra media to the trash"		#Tag Instance, Platform = Any, Language = nl, Definition  = \"Verplaats geselecteerde extra media naar de prullenmand"		#Tag Instance, Platform = Any, Language = fr, Definition  = \"D\xC3\xA9placer les extras \xC3\xA0 la corbeille."	#tag EndConstant	#tag Constant, Name = kToolTipDownoadExtras, Type = String, Dynamic = True, Default = \"Download extra images and media", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Download extra images and media"		#Tag Instance, Platform = Any, Language = nl, Definition  = \"Download extra afbeeldingen en media"	#tag EndConstant	#tag Constant, Name = kToolTipEditMetadata, Type = String, Dynamic = True, Default = \"Show and edit metadata", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Show and edit metadata"		#Tag Instance, Platform = Any, Language = nl, Definition  = \"Toon en bewerk metadata"	#tag EndConstant	#tag Constant, Name = kToolTipManageEpisodes, Type = String, Dynamic = True, Default = \"Manage your episodes", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Manage your episodes"		#Tag Instance, Platform = Any, Language = nl, Definition  = \"Beheer uw afleveringen"	#tag EndConstant	#tag Constant, Name = kToolTipManageSets, Type = String, Dynamic = True, Default = \"Manage your movie sets", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Manage your movie sets"		#Tag Instance, Platform = Any, Language = nl, Definition  = \"Beheer uw film sets"	#tag EndConstant	#tag Constant, Name = kToolTipManualSearch, Type = String, Dynamic = True, Default = \"Manually search for metadata", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Manually search for metadata"		#Tag Instance, Platform = Any, Language = nl, Definition  = \"Handmatig zoeken naar metadata"	#tag EndConstant	#tag Constant, Name = kToolTipSearchMedia, Type = String, Dynamic = True, Default = \"Search through the current list for the wanted media", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Search through the current list for the wanted media"		#Tag Instance, Platform = Any, Language = nl, Definition  = \"Zoekt in de huidige lijst naar de gewenste media"	#tag EndConstant	#tag Constant, Name = kToolTipSupport, Type = String, Dynamic = True, Default = \"Support the development of ViMediaManager", Scope = Protected		#Tag Instance, Platform = Any, Language = en, Definition  = \"Support the developing of ViMediaManager"		#Tag Instance, Platform = Any, Language = nl, Definition  = \"Ondersteun de ontwikkeling van ViMediaManager"	#tag EndConstant	#tag ViewBehavior		#tag ViewProperty			Name="Enabled"			Visible=true			Group="Appearance"			InitialValue="True"			Type="Boolean"			InheritedFrom="Toolbar"		#tag EndViewProperty		#tag ViewProperty			Name="Height"			Visible=true			Group="Position"			InitialValue="32"			Type="Integer"			InheritedFrom="Toolbar"		#tag EndViewProperty		#tag ViewProperty			Name="Index"			Visible=true			Group="ID"			Type="Integer"			InheritedFrom="Toolbar"		#tag EndViewProperty		#tag ViewProperty			Name="InitialParent"			InheritedFrom="Toolbar"		#tag EndViewProperty		#tag ViewProperty			Name="Left"			Visible=true			Group="Position"			Type="Integer"			InheritedFrom="Toolbar"		#tag EndViewProperty		#tag ViewProperty			Name="Name"			Visible=true			Group="ID"			Type="String"			InheritedFrom="Toolbar"		#tag EndViewProperty		#tag ViewProperty			Name="Super"			Visible=true			Group="ID"			InheritedFrom="Toolbar"		#tag EndViewProperty		#tag ViewProperty			Name="Top"			Visible=true			Group="Position"			Type="Integer"			InheritedFrom="Toolbar"		#tag EndViewProperty		#tag ViewProperty			Name="Visible"			Visible=true			Group="Appearance"			InitialValue="True"			Type="Boolean"			InheritedFrom="Toolbar"		#tag EndViewProperty		#tag ViewProperty			Name="Width"			Visible=true			Group="Position"			InitialValue="100"			Type="Integer"			InheritedFrom="Toolbar"		#tag EndViewProperty	#tag EndViewBehaviorEnd Class#tag EndClass