#tag ClassProtected Class FanartTVInherits HTTPSocket	#tag Event		Sub Error(code as integer)		  SocketError( code, Me )		  		Exception err as NilObjectException		  Me.Close		End Sub	#tag EndEvent	#tag Method, Flags = &h0		Sub GetArt(XmlContent as String, Mode as String, Lang as String = "All", First as Boolean = False)		  // Modes:		  //       TV: All / clearlogo / clearart / characterart / tvthumb / seasonthumb		  //   Movies: All / movielogo / movieart -> clearart / moviedisc / moviebackgrounds (Fanart)		  //    Music: All / cdart / artistbackground / albumcover / musiclogo / artistthumbs		  		  Dim Xml as new XmlDocument		  Dim xroot, xnode, xitem as XmlNode		  Dim Season() as String		  Scrape.ClearArts		  		  Xml.PreserveWhitespace = False		  Xml.LoadXml( XmlContent )		  If Xml.FirstChild <> Nil And _		    Xml.FirstChild.FirstChild <> Nil And _		    Xml.FirstChild.FirstChild.FirstChild <> Nil Then xroot = Xml.FirstChild.FirstChild.FirstChild		    		    // Use nice language for user feedback, and other important details.		    Dim NiceMode, Destination, ImageType as String		    Dim ArtMaxSize as Integer = 512		    Select Case Mode		      		    Case "all"		      NiceMode = ""		      		    case "clearlogo"		      NiceMode = Localizable.kLogo.Lowercase		      Destination = "logo"		      ImageType = "png"		      ArtMaxSize = 400 * 1.2		    case "clearart"		      NiceMode = "clear art"		      Destination = "clearart"		      ImageType = "png"		      ArtMaxSize = 500 * 1.2		    case "characterart"		      NiceMode = "character art"		      Destination = "characterart"		      ImageType = "png"		      ArtMaxSize = 512 * 1.2		    case "tvthumb"		      NiceMode = Localizable.kTVThumb.Lowercase		      Destination = "landscape"		      ImageType = "jpg"		      ArtMaxSize = 500 * 1.2		    case "seasonthumb"		      NiceMode = Localizable.kSeasonThumb.Lowercase		      destination = "season"		      ImageType = "jpg"		      ArtMaxSize = 500 * 1.2		    case "showbackground"		      NiceMode = Localizable.kFanart		      Destination = "fanart"		      ImageType = "jpg"		      ArtMaxSize = 1920 / 3		      		    case "movielogo"		      NiceMode = Localizable.kLogo.Lowercase		      Destination = "logo"		      ImageType = "png"		      ArtMaxSize = 400 * 1.2		    case "movieart"		      NiceMode = "clear art"		      Destination = "clearart"		      ImageType = "png"		      ArtMaxSize = 500 * 1.2		    case "moviedisc"		      NiceMode = Localizable.kDiscArt.Lowercase		      Destination = "disc"		      ImageType = "png"		      ArtMaxSize = 1000 / 2		    case "moviebackgrounds"		      NiceMode = Localizable.kFanart.Lowercase		      Destination = MovieAttr.DestinationFanart( MovieAttr.FolderParent ).NameWithoutExtension		      ImageType = "jpg"		      ArtMaxSize = 1920 / 3		      		    End Select		    		    // No images available.		    If xroot = Nil OR xroot.ChildCount <= 0 Then		      If NOT First And NOT Scrape.MassSearch Then MsgBox Scrape.kNoImagesFound.ReplaceAll("%S", NiceMode)		      Return		    End If		    		    		    Dim ArtIndex as Integer = -1		    For i as Integer = 0 to xroot.ChildCount -1		      xnode = xroot.Child(i)		      		      If Lang <> "All" And xnode.GetAttribute("lang") = Lang Then		        ArtURL.Append xnode.GetAttribute("url")		      Else		        ArtURL.Append xnode.GetAttribute("url")		      End If		      		      If Mode = "seasonthumb" And xnode.GetAttribute("season") <> "" Then Season.Append xnode.GetAttribute("season")		      		      ArtIndex = ArtIndex + 1		    Next		    		    // No images found		    If NOT Scrape.MassSearch And Scrape.ArtURL.Ubound <= -1 Then		      MsgBox Scrape.kNoImagesFound.ReplaceAll( "%s", NiceMode ).ReplaceAll("  ", " ")		      Return		    End If		    		    Dim Sckt as new HTTPSocket		    sckt.Yield = True		    		    If ArtURL.Ubound > 0 And NOT First Then		      // More then 1 images found.		      		      For i as Integer = 0 to ArtURL.Ubound		        // Update Progress		        If NOT First And NOT Scrape.MassSearch And i = 0 Then		          dlgProgress.Reset		        ElseIf NOT First And NOT Scrape.MassSearch Then		          dlgProgress.Add( Localizable.kDownload + ":", Str( i + 1 ) + Localizable.k1of2 + Str( ArtIndex + 1 ) + " " + NiceMode + " " + Localizable.kImages, 1, ArtIndex + 1 )		        End If		        		        If Mode = "seasonthumb" Then		          'Dim s as String = Season(i)		          'If s = "0" Then s = "-specials"		          'If s = "all" Then s = "-all"		          'Scrape.ArtThumb.Append URL2Picture( ArtURL(i), "season" + Season(i)		        Else		          Scrape.ArtThumb.Append Picture.FromData( sckt.Get( ArtURL(i), Prefs.integerForKey("TimeOut") ) )		        End If		        		      Next		      		    ElseIf ArtURL.Ubound = 0 Or First Then		      // Download first and only image.		      		      If NOT First And NOT Scrape.MassSearch Then dlgProgress.Reset		      Dim Location as FolderItem		      Dim LstBox as Listbox		      		      Select Case wndMain.ppMain.Value		      case 0		        Location = MovieAttr.FolderParent		        LstBox = wndMain.lstMovies		      case 1		        'Location = TVAttr.FolderParent		        'LstBox = wndMain.lstTVShows		      case 2		        'Location = AnimeAttr.FolderParent		        'LstBox = wndMain.lstAnime		      End Select		      		      Scrape.ArtThumb.Append URL2Picture( ArtURL(0), Destination, ImageType, Location )		      		      If LstBox = wndMain.lstMovies  Then wndMain.lstMovies.UpdateRow		      'If LstBox = wndMain.lstTVShows Then wndMain.lstTVShows.UpdateRow		      'If LstBox = wndMain.lstAnime   Then wndMain.lstAnime.UpdateRow		      		    End If		    		    If NOT First And NOT Scrape.MassSearch And Mode <> "seasonthumb" and ArtURL.Ubound > 0 then		      wndArtPreview.Show		      wndArtPreview.cvsThumbs.Thumbs = Scrape.ArtThumb		      'wndArtPreview.cvsThumbs.ThumbDimensions = Scrape.ArtSize		      'If Mode = "Poster" then wndArtPreview.sldThumbSize.Maximum = 274 * 1.2 Else wndArtPreview.sldThumbSize.Maximum = 300 * 1.2		      wndArtPreview.sldThumbSize.Maximum = ArtMaxSize		      wndArtPreview.cvsThumbs.Selection = 0		      wndArtPreview.Mode = "FanartTV-" + Mode		      wndArtPreview.cvsThumbs.Invalidate False		    End If		    		    Return		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Function URL_Images(ID as String, Type as String = "all", Service as String = "series", All as Boolean = True) As String		  Dim AllStr as String = "1"		  If All Then AllStr = "2"		  Return "http://fanart.tv/webservice/" + Service + "/" + ApiKey + "/" + ID + "/xml/" + Type + "/1/" + AllStr + "/"		End Function	#tag EndMethod	#tag Constant, Name = ApiKey, Type = String, Dynamic = False, Default = \"79220e0c14eab8f46eedbb611288572e", Scope = Public	#tag EndConstant	#tag ViewBehavior		#tag ViewProperty			Name="Address"			Visible=true			Group="Behavior"			Type="String"			InheritedFrom="TCPSocket"		#tag EndViewProperty		#tag ViewProperty			Name="defaultPort"			Group="Behavior"			InitialValue="0"			Type="integer"			InheritedFrom="HTTPSocket"		#tag EndViewProperty		#tag ViewProperty			Name="httpProxyAddress"			Group="Behavior"			Type="string"			EditorType="MultiLineEditor"			InheritedFrom="HTTPSocket"		#tag EndViewProperty		#tag ViewProperty			Name="httpProxyPort"			Group="Behavior"			InitialValue="0"			Type="integer"			InheritedFrom="HTTPSocket"		#tag EndViewProperty		#tag ViewProperty			Name="Index"			Visible=true			Group="ID"			Type="Integer"			InheritedFrom="TCPSocket"		#tag EndViewProperty		#tag ViewProperty			Name="Left"			Visible=true			Group="Position"			InheritedFrom="TCPSocket"		#tag EndViewProperty		#tag ViewProperty			Name="Name"			Visible=true			Group="ID"			InheritedFrom="TCPSocket"		#tag EndViewProperty		#tag ViewProperty			Name="Port"			Visible=true			Group="Behavior"			InitialValue="0"			Type="Integer"			InheritedFrom="TCPSocket"		#tag EndViewProperty		#tag ViewProperty			Name="Super"			Visible=true			Group="ID"			InheritedFrom="TCPSocket"		#tag EndViewProperty		#tag ViewProperty			Name="Top"			Visible=true			Group="Position"			InheritedFrom="TCPSocket"		#tag EndViewProperty		#tag ViewProperty			Name="yield"			Group="Behavior"			InitialValue="0"			Type="boolean"			InheritedFrom="HTTPSocket"		#tag EndViewProperty	#tag EndViewBehaviorEnd Class#tag EndClass